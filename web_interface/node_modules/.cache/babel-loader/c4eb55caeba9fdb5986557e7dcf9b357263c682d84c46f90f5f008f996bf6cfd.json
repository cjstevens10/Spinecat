{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\coope\\\\CursorWorkspace\\\\Spinecat\\\\web_interface\\\\src\\\\components\\\\SpineVisualizer.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect, useCallback } from 'react';\nimport { BookOpen, AlertCircle, Plus, Save, X, Move } from 'lucide-react';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst SpineVisualizer = ({\n  imageUrl,\n  spineRegions,\n  bookMatches,\n  selectedSpineId,\n  onSpineSelected,\n  isFinalized,\n  onSpineRegionsUpdated,\n  onManualSpineAdded,\n  onStopEditing,\n  editingBookId\n}) => {\n  _s();\n  const [imageLoaded, setImageLoaded] = useState(false);\n  const [hoveredSpineId, setHoveredSpineId] = useState(null);\n  const [imageScale, setImageScale] = useState({\n    scaleX: 1,\n    scaleY: 1,\n    offsetX: 0,\n    offsetY: 0\n  });\n  const [overlayRect, setOverlayRect] = useState(null);\n  const [editingState, setEditingState] = useState({\n    mode: 'none',\n    spineId: null,\n    vertexIndex: null,\n    isDragging: false\n  });\n  const [drawingPoints, setDrawingPoints] = useState([]);\n  const imageRef = useRef(null);\n  const containerRef = useRef(null);\n  const svgRef = useRef(null);\n\n  // Debug logging for editingBookId\n  console.log('🔍 SpineVisualizer editingBookId:', editingBookId);\n\n  // Auto-enter editing mode when editingBookId changes\n  useEffect(() => {\n    if (editingBookId) {\n      console.log('🔄 Auto-entering editing mode for book:', editingBookId);\n      // Find the spine region for this book\n      const book = bookMatches.find(b => b.id === editingBookId);\n      if (book && book.spine_region_id) {\n        const spine = spineRegions.find(s => s.id === book.spine_region_id);\n        if (spine) {\n          console.log('✅ Found spine, entering editing mode');\n          setEditingState({\n            mode: 'editing',\n            spineId: spine.id,\n            vertexIndex: null,\n            isDragging: false\n          });\n        } else {\n          console.log('❌ No spine found for book, entering drawing mode');\n          setEditingState({\n            mode: 'drawing',\n            spineId: editingBookId,\n            vertexIndex: null,\n            isDragging: false\n          });\n        }\n      } else {\n        console.log('❌ No book or spine_region_id found, entering drawing mode');\n        setEditingState({\n          mode: 'drawing',\n          spineId: editingBookId,\n          vertexIndex: null,\n          isDragging: false\n        });\n      }\n    } else {\n      console.log('🔄 Exiting editing mode');\n      setEditingState({\n        mode: 'none',\n        spineId: null,\n        vertexIndex: null,\n        isDragging: false\n      });\n    }\n  }, [editingBookId, bookMatches, spineRegions]);\n\n  // Calculate image scale and offset when image loads\n  useEffect(() => {\n    if (imageRef.current && imageLoaded) {\n      const img = imageRef.current;\n      const container = containerRef.current;\n      if (container) {\n        const containerRect = container.getBoundingClientRect();\n        const imgRect = img.getBoundingClientRect();\n\n        // Calculate scale factors\n        const scaleX = imgRect.width / img.naturalWidth;\n        const scaleY = imgRect.height / img.naturalHeight;\n\n        // Calculate offset (difference between container and image positioning)\n        const offsetX = imgRect.left - containerRect.left;\n        const offsetY = imgRect.top - containerRect.top;\n        setImageScale({\n          scaleX,\n          scaleY,\n          offsetX,\n          offsetY\n        });\n        setOverlayRect({\n          left: offsetX,\n          top: offsetY,\n          width: imgRect.width,\n          height: imgRect.height\n        });\n      }\n    }\n  }, [imageLoaded]);\n\n  // Convert spine polygon to scaled SVG points string\n  const getScaledPoints = spine => {\n    if (!spine.coordinates || spine.coordinates.length === 0) return '';\n    return spine.coordinates.map(([x, y]) => {\n      const sx = x * imageScale.scaleX;\n      const sy = y * imageScale.scaleY;\n      return `${sx},${sy}`;\n    }).join(' ');\n  };\n\n  // Convert SVG coordinates back to image coordinates\n  const getImageCoordinates = (svgX, svgY) => {\n    return [svgX / imageScale.scaleX, svgY / imageScale.scaleY];\n  };\n\n  // Compute centroid for label/tooltip positioning within overlay\n  const getCentroid = spine => {\n    if (!spine.coordinates || spine.coordinates.length === 0) return {\n      x: 0,\n      y: 0\n    };\n    const pts = spine.coordinates;\n    const cx = pts.reduce((a, p) => a + p[0], 0) / pts.length;\n    const cy = pts.reduce((a, p) => a + p[1], 0) / pts.length;\n    return {\n      x: cx * imageScale.scaleX,\n      y: cy * imageScale.scaleY\n    };\n  };\n\n  // Helper function to get spine region by ID\n  const getSpineRegion = id => {\n    return spineRegions.find(spine => spine.id === id);\n  };\n\n  // Helper function to get book data for a spine\n  const getBookData = spineId => {\n    const book = bookMatches.find(book => book.spine_region_id === spineId);\n    console.log('🔍 getBookData for spine:', spineId, 'found book:', book === null || book === void 0 ? void 0 : book.id, 'title:', book === null || book === void 0 ? void 0 : book.title);\n    return book;\n  };\n\n  // Handle spine region click\n  const handleSpineClick = spineId => {\n    if (editingState.mode === 'drawing') return; // Don't select while drawing\n    onSpineSelected(spineId);\n  };\n\n  // Handle spine region hover\n  const handleSpineHover = spineId => {\n    if (editingState.mode === 'drawing') return; // Don't hover while drawing\n    setHoveredSpineId(spineId);\n  };\n\n  // Start editing mode for a spine\n  const startEditing = spineId => {\n    setEditingState({\n      mode: 'editing',\n      spineId,\n      vertexIndex: null,\n      isDragging: false\n    });\n  };\n\n  // Start drawing mode for manual entry\n  const startDrawing = spineId => {\n    setEditingState({\n      mode: 'drawing',\n      spineId,\n      vertexIndex: null,\n      isDragging: false\n    });\n    setDrawingPoints([]);\n  };\n\n  // Cancel editing/drawing mode\n  const cancelEditing = () => {\n    setEditingState({\n      mode: 'none',\n      spineId: null,\n      vertexIndex: null,\n      isDragging: false\n    });\n    setDrawingPoints([]);\n  };\n\n  // Save manual drawing\n  const saveManualDrawing = () => {\n    if (drawingPoints.length >= 3 && onManualSpineAdded && editingBookId) {\n      const newSpine = {\n        id: `manual_${Date.now()}`,\n        x: Math.min(...drawingPoints.map(p => p[0])),\n        y: Math.min(...drawingPoints.map(p => p[1])),\n        width: Math.max(...drawingPoints.map(p => p[0])) - Math.min(...drawingPoints.map(p => p[0])),\n        height: Math.max(...drawingPoints.map(p => p[1])) - Math.min(...drawingPoints.map(p => p[1])),\n        rotation: 0,\n        confidence: 0.9,\n        coordinates: drawingPoints\n      };\n      onManualSpineAdded(newSpine);\n      cancelEditing();\n    }\n  };\n\n  // Handle SVG click for drawing\n  const handleSvgClick = event => {\n    if (editingState.mode !== 'drawing') return;\n    const svg = svgRef.current;\n    if (!svg) return;\n    const rect = svg.getBoundingClientRect();\n    const x = event.clientX - rect.left;\n    const y = event.clientY - rect.top;\n    const imageCoords = getImageCoordinates(x, y);\n    setDrawingPoints(prev => [...prev, imageCoords]);\n  };\n\n  // Handle vertex drag start\n  const handleVertexDragStart = (spineId, vertexIndex) => {\n    setEditingState(prev => ({\n      ...prev,\n      mode: 'editing',\n      spineId,\n      vertexIndex,\n      isDragging: true\n    }));\n  };\n\n  // Handle vertex drag\n  const handleVertexDrag = useCallback((spineId, vertexIndex, newX, newY) => {\n    if (!onSpineRegionsUpdated) return;\n    const imageCoords = getImageCoordinates(newX, newY);\n    const updatedRegions = spineRegions.map(spine => {\n      if (spine.id === spineId && spine.coordinates) {\n        const newCoordinates = [...spine.coordinates];\n        newCoordinates[vertexIndex] = imageCoords;\n        return {\n          ...spine,\n          coordinates: newCoordinates\n        };\n      }\n      return spine;\n    });\n    onSpineRegionsUpdated(updatedRegions);\n  }, [spineRegions, onSpineRegionsUpdated, imageScale]);\n\n  // Handle mouse move for vertex dragging\n  const handleMouseMove = useCallback(event => {\n    if (editingState.mode !== 'editing' || !editingState.isDragging || !editingState.spineId || editingState.vertexIndex === null) return;\n    const svg = svgRef.current;\n    if (!svg) return;\n    const rect = svg.getBoundingClientRect();\n    const x = event.clientX - rect.left;\n    const y = event.clientY - rect.top;\n    handleVertexDrag(editingState.spineId, editingState.vertexIndex, x, y);\n  }, [editingState, handleVertexDrag]);\n\n  // Handle vertex drag end\n  const handleVertexDragEnd = () => {\n    setEditingState(prev => ({\n      ...prev,\n      isDragging: false\n    }));\n  };\n\n  // Render vertex handles for editing\n  const renderVertexHandles = spine => {\n    var _spine$coordinates;\n    if (editingState.mode !== 'editing' || editingState.spineId !== spine.id) return null;\n    return (_spine$coordinates = spine.coordinates) === null || _spine$coordinates === void 0 ? void 0 : _spine$coordinates.map((coord, index) => {\n      const [x, y] = coord;\n      const svgX = x * imageScale.scaleX;\n      const svgY = y * imageScale.scaleY;\n      return /*#__PURE__*/_jsxDEV(\"circle\", {\n        cx: svgX,\n        cy: svgY,\n        r: 6,\n        fill: \"#FF6B6B\",\n        stroke: \"#FF4757\",\n        strokeWidth: 2,\n        cursor: \"move\",\n        onMouseDown: e => {\n          e.stopPropagation();\n          handleVertexDragStart(spine.id, index);\n        },\n        onMouseUp: handleVertexDragEnd,\n        style: {\n          pointerEvents: editingState.isDragging ? 'none' : 'auto'\n        }\n      }, `vertex-${spine.id}-${index}`, false, {\n        fileName: _jsxFileName,\n        lineNumber: 303,\n        columnNumber: 9\n      }, this);\n    });\n  };\n\n  // Render drawing points\n  const renderDrawingPoints = () => {\n    if (editingState.mode !== 'drawing' || drawingPoints.length === 0) return null;\n    return /*#__PURE__*/_jsxDEV(\"g\", {\n      children: [drawingPoints.length > 1 && /*#__PURE__*/_jsxDEV(\"polyline\", {\n        points: drawingPoints.map(([x, y]) => `${x * imageScale.scaleX},${y * imageScale.scaleY}`).join(' '),\n        fill: \"none\",\n        stroke: \"#FF6B6B\",\n        strokeWidth: 2,\n        strokeDasharray: \"5,5\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 331,\n        columnNumber: 11\n      }, this), drawingPoints.map(([x, y], index) => /*#__PURE__*/_jsxDEV(\"circle\", {\n        cx: x * imageScale.scaleX,\n        cy: y * imageScale.scaleY,\n        r: 4,\n        fill: \"#FF6B6B\",\n        stroke: \"#FF4757\",\n        strokeWidth: 2\n      }, `drawing-${index}`, false, {\n        fileName: _jsxFileName,\n        lineNumber: 342,\n        columnNumber: 11\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 328,\n      columnNumber: 7\n    }, this);\n  };\n\n  // Render spine region as polygon within an SVG aligned to the image\n  const renderSpineRegion = spine => {\n    const book = getBookData(spine.id);\n    const points = getScaledPoints(spine);\n    const {\n      x: cx,\n      y: cy\n    } = getCentroid(spine);\n    const isSelected = selectedSpineId === spine.id;\n    const isHovered = hoveredSpineId === spine.id;\n    const isEditing = editingState.mode === 'editing' && editingState.spineId === spine.id;\n    const isDrawing = editingState.mode === 'drawing' && editingState.spineId === spine.id;\n    const hasSelection = selectedSpineId !== null;\n    const isOtherSelected = hasSelection && !isSelected;\n\n    // Debug logging\n    console.log('🔍 Rendering spine:', spine.id, 'editingBookId:', editingBookId, 'book?.spine_region_id:', book === null || book === void 0 ? void 0 : book.spine_region_id);\n\n    // Only show spines that are being edited or not in editing mode\n    if (editingBookId && !isEditing && !isDrawing) {\n      // Check if this spine belongs to the book being edited\n      const isTargetBook = book && book.id === editingBookId;\n      if (!isTargetBook) {\n        console.log('🚫 Hiding spine:', spine.id, 'because it\\'s not the editing target book');\n        return null;\n      }\n    }\n    const fill = isEditing || isDrawing ? 'rgba(255,107,107,0.3)' : isSelected ? 'rgba(59,130,246,0.25)' : isHovered ? 'rgba(59,130,246,0.18)' : 'rgba(59,130,246,0.12)';\n    const stroke = isEditing || isDrawing ? '#FF6B6B' : isSelected ? '#60A5FA' : isHovered ? '#3B82F6' : '#2563EB';\n    const opacity = isOtherSelected && !isEditing && !isDrawing ? 0.35 : 1;\n    return /*#__PURE__*/_jsxDEV(\"g\", {\n      style: {\n        opacity\n      },\n      onMouseEnter: () => handleSpineHover(spine.id),\n      onMouseLeave: () => handleSpineHover(null),\n      onClick: () => handleSpineClick(spine.id),\n      children: [/*#__PURE__*/_jsxDEV(\"polygon\", {\n        points: points,\n        fill: fill,\n        stroke: stroke,\n        strokeWidth: 2\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 397,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"text\", {\n        x: cx,\n        y: cy,\n        textAnchor: \"middle\",\n        dominantBaseline: \"middle\",\n        fill: \"#fff\",\n        fontSize: 12,\n        fontWeight: 600,\n        children: spineRegions.findIndex(s => s.id === spine.id) + 1\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 400,\n        columnNumber: 9\n      }, this), renderVertexHandles(spine), hoveredSpineId === spine.id && book && overlayRect && !isEditing && /*#__PURE__*/_jsxDEV(\"foreignObject\", {\n        x: Math.min(Math.max(cx + 8, 0), overlayRect.width - 200),\n        y: Math.max(cy - 40, 0),\n        width: 200,\n        height: 80,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-gray-900 text-white text-xs px-3 py-2 rounded-lg shadow-lg\",\n          style: {\n            pointerEvents: 'none'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"font-medium mb-1 truncate\",\n            children: book.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 413,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-gray-300 truncate\",\n            children: [\"by \", Array.isArray(book.author_name) ? book.author_name.join(', ') : book.author_name || 'Unknown Author']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 414,\n            columnNumber: 15\n          }, this), book.first_publish_year && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-gray-400\",\n            children: book.first_publish_year\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 416,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 412,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 411,\n        columnNumber: 11\n      }, this)]\n    }, spine.id, true, {\n      fileName: _jsxFileName,\n      lineNumber: 392,\n      columnNumber: 7\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"card p-0 overflow-hidden\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-6 border-b border-gray-200\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center justify-between\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"text-lg font-semibold text-gray-900 mb-2\",\n            children: \"Book Spine Detection\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 431,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm text-gray-600\",\n            children: [spineRegions.length, \" spine\", spineRegions.length !== 1 ? 's' : '', \" detected\", bookMatches.length > 0 && ` • ${bookMatches.length} book${bookMatches.length !== 1 ? 's' : ''} identified`]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 434,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 430,\n          columnNumber: 11\n        }, this), !isFinalized && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-2\",\n          children: [editingState.mode === 'none' && editingBookId && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => startDrawing(editingBookId),\n              className: \"btn-secondary text-sm px-3 py-1 flex items-center space-x-1\",\n              children: [/*#__PURE__*/_jsxDEV(Plus, {\n                className: \"w-4 h-4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 449,\n                columnNumber: 22\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Draw OBB\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 450,\n                columnNumber: 22\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 445,\n              columnNumber: 20\n            }, this)\n          }, void 0, false), editingState.mode === 'drawing' && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: saveManualDrawing,\n              disabled: drawingPoints.length < 3,\n              className: \"btn-primary text-sm px-3 py-1 flex items-center space-x-1 disabled:opacity-50\",\n              children: [/*#__PURE__*/_jsxDEV(Save, {\n                className: \"w-4 h-4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 462,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Save OBB\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 463,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 457,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: cancelEditing,\n              className: \"btn-danger text-sm px-3 py-1 flex items-center space-x-1\",\n              children: [/*#__PURE__*/_jsxDEV(X, {\n                className: \"w-4 h-4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 469,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Cancel\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 470,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 465,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true), editingState.mode === 'editing' && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => startDrawing(editingBookId || ''),\n              className: \"btn-secondary text-sm px-3 py-1 flex items-center space-x-1\",\n              children: [/*#__PURE__*/_jsxDEV(Plus, {\n                className: \"w-4 h-4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 481,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Draw New OBB\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 482,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 477,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: cancelEditing,\n              className: \"btn-secondary text-sm px-3 py-1 flex items-center space-x-1\",\n              children: [/*#__PURE__*/_jsxDEV(Move, {\n                className: \"w-4 h-4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 488,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Drag vertices to edit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 489,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 484,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => {\n                cancelEditing();\n                if (onStopEditing) onStopEditing();\n              },\n              className: \"btn-primary text-sm px-3 py-1 flex items-center space-x-1\",\n              children: [/*#__PURE__*/_jsxDEV(Save, {\n                className: \"w-4 h-4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 498,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Done\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 499,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 491,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 442,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 429,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 428,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: containerRef,\n      className: \"relative bg-gray-100 min-h-[400px] flex items-center justify-center\",\n      children: [!imageLoaded && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center text-gray-500\",\n        children: [/*#__PURE__*/_jsxDEV(BookOpen, {\n          className: \"w-12 h-12 mx-auto mb-2 text-gray-400\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 515,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Loading image...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 516,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 514,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n        ref: imageRef,\n        src: imageUrl,\n        alt: \"Book spines\",\n        className: \"max-w-full max-h-[600px] object-contain\",\n        onLoad: () => setImageLoaded(true),\n        onError: () => setImageLoaded(false)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 521,\n        columnNumber: 9\n      }, this), imageLoaded && overlayRect && /*#__PURE__*/_jsxDEV(\"svg\", {\n        ref: svgRef,\n        className: \"absolute cursor-crosshair\",\n        style: {\n          left: overlayRect.left,\n          top: overlayRect.top\n        },\n        width: overlayRect.width,\n        height: overlayRect.height,\n        onClick: handleSvgClick,\n        onMouseMove: handleMouseMove,\n        onMouseUp: handleVertexDragEnd,\n        children: [spineRegions.map(renderSpineRegion), renderDrawingPoints()]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 532,\n        columnNumber: 11\n      }, this), imageLoaded && spineRegions.length === 0 && editingState.mode !== 'drawing' && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute inset-0 flex items-center justify-center bg-white bg-opacity-90\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-center text-gray-500\",\n          children: [/*#__PURE__*/_jsxDEV(AlertCircle, {\n            className: \"w-12 h-12 mx-auto mb-2 text-gray-400\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 551,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-lg font-medium\",\n            children: \"No book spines detected\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 552,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm\",\n            children: \"Try uploading a clearer image or draw spines manually\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 553,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 550,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 549,\n        columnNumber: 11\n      }, this), imageLoaded && editingState.mode === 'drawing' && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute top-4 left-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-sm font-medium\",\n          children: \"Click to add vertices. Need at least 3 points.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 561,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-xs opacity-90\",\n          children: \"Click \\\"Save OBB\\\" when done\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 562,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 560,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 509,\n      columnNumber: 7\n    }, this), spineRegions.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-4 bg-gray-50 border-t border-gray-200\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center justify-between text-sm text-gray-600\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center space-x-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-3 h-3 bg-primary-500 rounded\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 573,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Detected spine\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 574,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 572,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center space-x-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-3 h-3 bg-primary-600 rounded ring-2 ring-primary-400\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 577,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Selected\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 578,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 576,\n            columnNumber: 15\n          }, this), !isFinalized && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center space-x-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"w-3 h-3 bg-red-500 rounded\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 583,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Editing\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 584,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 582,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center space-x-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"w-3 h-3 bg-red-400 rounded\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 587,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Drawing\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 588,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 586,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 571,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-xs\",\n          children: [editingState.mode === 'none' && 'Click on spine regions to select books', editingState.mode === 'drawing' && 'Click on image to draw spine outline', editingState.mode === 'editing' && 'Drag red vertices to edit spine shape']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 594,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 570,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 569,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 426,\n    columnNumber: 5\n  }, this);\n};\n_s(SpineVisualizer, \"bYylqnFxg1s5AdkN+JuWE2BFovc=\");\n_c = SpineVisualizer;\nexport default SpineVisualizer;\nvar _c;\n$RefreshReg$(_c, \"SpineVisualizer\");","map":{"version":3,"names":["React","useState","useRef","useEffect","useCallback","BookOpen","AlertCircle","Plus","Save","X","Move","jsxDEV","_jsxDEV","Fragment","_Fragment","SpineVisualizer","imageUrl","spineRegions","bookMatches","selectedSpineId","onSpineSelected","isFinalized","onSpineRegionsUpdated","onManualSpineAdded","onStopEditing","editingBookId","_s","imageLoaded","setImageLoaded","hoveredSpineId","setHoveredSpineId","imageScale","setImageScale","scaleX","scaleY","offsetX","offsetY","overlayRect","setOverlayRect","editingState","setEditingState","mode","spineId","vertexIndex","isDragging","drawingPoints","setDrawingPoints","imageRef","containerRef","svgRef","console","log","book","find","b","id","spine_region_id","spine","s","current","img","container","containerRect","getBoundingClientRect","imgRect","width","naturalWidth","height","naturalHeight","left","top","getScaledPoints","coordinates","length","map","x","y","sx","sy","join","getImageCoordinates","svgX","svgY","getCentroid","pts","cx","reduce","a","p","cy","getSpineRegion","getBookData","title","handleSpineClick","handleSpineHover","startEditing","startDrawing","cancelEditing","saveManualDrawing","newSpine","Date","now","Math","min","max","rotation","confidence","handleSvgClick","event","svg","rect","clientX","clientY","imageCoords","prev","handleVertexDragStart","handleVertexDrag","newX","newY","updatedRegions","newCoordinates","handleMouseMove","handleVertexDragEnd","renderVertexHandles","_spine$coordinates","coord","index","r","fill","stroke","strokeWidth","cursor","onMouseDown","e","stopPropagation","onMouseUp","style","pointerEvents","fileName","_jsxFileName","lineNumber","columnNumber","renderDrawingPoints","children","points","strokeDasharray","renderSpineRegion","isSelected","isHovered","isEditing","isDrawing","hasSelection","isOtherSelected","isTargetBook","opacity","onMouseEnter","onMouseLeave","onClick","textAnchor","dominantBaseline","fontSize","fontWeight","findIndex","className","Array","isArray","author_name","first_publish_year","disabled","ref","src","alt","onLoad","onError","onMouseMove","_c","$RefreshReg$"],"sources":["C:/Users/coope/CursorWorkspace/Spinecat/web_interface/src/components/SpineVisualizer.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from 'react';\nimport { motion } from 'framer-motion';\nimport { BookOpen, AlertCircle, Edit3, Plus, Save, X, Move } from 'lucide-react';\n\nimport { SpineRegion, BookMatch } from '../types';\n\ninterface SpineVisualizerProps {\n  imageUrl: string;\n  spineRegions: SpineRegion[];\n  bookMatches: BookMatch[];\n  selectedSpineId: string | null;\n  onSpineSelected: (spineId: string) => void;\n  isFinalized: boolean;\n  onSpineRegionsUpdated?: (updatedRegions: SpineRegion[]) => void;\n  onManualSpineAdded?: (newSpine: SpineRegion) => void;\n  onStopEditing?: () => void;\n  editingBookId?: string | null; // ID of the book being edited\n}\n\ninterface EditingState {\n  mode: 'none' | 'drawing' | 'editing';\n  spineId: string | null;\n  vertexIndex: number | null;\n  isDragging: boolean;\n}\n\nconst SpineVisualizer: React.FC<SpineVisualizerProps> = ({\n  imageUrl,\n  spineRegions,\n  bookMatches,\n  selectedSpineId,\n  onSpineSelected,\n  isFinalized,\n  onSpineRegionsUpdated,\n  onManualSpineAdded,\n  onStopEditing,\n  editingBookId\n}) => {\n  const [imageLoaded, setImageLoaded] = useState(false);\n  const [hoveredSpineId, setHoveredSpineId] = useState<string | null>(null);\n  const [imageScale, setImageScale] = useState({ scaleX: 1, scaleY: 1, offsetX: 0, offsetY: 0 });\n  const [overlayRect, setOverlayRect] = useState<{ left: number; top: number; width: number; height: number } | null>(null);\n  const [editingState, setEditingState] = useState<EditingState>({\n    mode: 'none',\n    spineId: null,\n    vertexIndex: null,\n    isDragging: false\n  });\n  const [drawingPoints, setDrawingPoints] = useState<[number, number][]>([]);\n  \n  const imageRef = useRef<HTMLImageElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const svgRef = useRef<SVGSVGElement>(null);\n\n  // Debug logging for editingBookId\n  console.log('🔍 SpineVisualizer editingBookId:', editingBookId);\n\n  // Auto-enter editing mode when editingBookId changes\n  useEffect(() => {\n    if (editingBookId) {\n      console.log('🔄 Auto-entering editing mode for book:', editingBookId);\n      // Find the spine region for this book\n      const book = bookMatches.find(b => b.id === editingBookId);\n      if (book && book.spine_region_id) {\n        const spine = spineRegions.find(s => s.id === book.spine_region_id);\n        if (spine) {\n          console.log('✅ Found spine, entering editing mode');\n          setEditingState({\n            mode: 'editing',\n            spineId: spine.id,\n            vertexIndex: null,\n            isDragging: false\n          });\n        } else {\n          console.log('❌ No spine found for book, entering drawing mode');\n          setEditingState({\n            mode: 'drawing',\n            spineId: editingBookId,\n            vertexIndex: null,\n            isDragging: false\n          });\n        }\n      } else {\n        console.log('❌ No book or spine_region_id found, entering drawing mode');\n        setEditingState({\n          mode: 'drawing',\n          spineId: editingBookId,\n          vertexIndex: null,\n          isDragging: false\n        });\n      }\n    } else {\n      console.log('🔄 Exiting editing mode');\n      setEditingState({\n        mode: 'none',\n        spineId: null,\n        vertexIndex: null,\n        isDragging: false\n      });\n    }\n  }, [editingBookId, bookMatches, spineRegions]);\n\n  // Calculate image scale and offset when image loads\n  useEffect(() => {\n    if (imageRef.current && imageLoaded) {\n      const img = imageRef.current;\n      const container = containerRef.current;\n      \n      if (container) {\n        const containerRect = container.getBoundingClientRect();\n        const imgRect = img.getBoundingClientRect();\n        \n        // Calculate scale factors\n        const scaleX = imgRect.width / img.naturalWidth;\n        const scaleY = imgRect.height / img.naturalHeight;\n        \n        // Calculate offset (difference between container and image positioning)\n        const offsetX = imgRect.left - containerRect.left;\n        const offsetY = imgRect.top - containerRect.top;\n        \n        setImageScale({ scaleX, scaleY, offsetX, offsetY });\n        setOverlayRect({ left: offsetX, top: offsetY, width: imgRect.width, height: imgRect.height });\n      }\n    }\n  }, [imageLoaded]);\n\n  // Convert spine polygon to scaled SVG points string\n  const getScaledPoints = (spine: SpineRegion) => {\n    if (!spine.coordinates || spine.coordinates.length === 0) return '';\n    return spine.coordinates\n      .map(([x, y]) => {\n        const sx = x * imageScale.scaleX;\n        const sy = y * imageScale.scaleY;\n        return `${sx},${sy}`;\n      })\n      .join(' ');\n  };\n\n  // Convert SVG coordinates back to image coordinates\n  const getImageCoordinates = (svgX: number, svgY: number): [number, number] => {\n    return [svgX / imageScale.scaleX, svgY / imageScale.scaleY];\n  };\n\n  // Compute centroid for label/tooltip positioning within overlay\n  const getCentroid = (spine: SpineRegion) => {\n    if (!spine.coordinates || spine.coordinates.length === 0) return { x: 0, y: 0 };\n    const pts = spine.coordinates;\n    const cx = pts.reduce((a, p) => a + p[0], 0) / pts.length;\n    const cy = pts.reduce((a, p) => a + p[1], 0) / pts.length;\n    return { x: cx * imageScale.scaleX, y: cy * imageScale.scaleY };\n  };\n\n  // Helper function to get spine region by ID\n  const getSpineRegion = (id: string) => {\n    return spineRegions.find(spine => spine.id === id);\n  };\n\n  // Helper function to get book data for a spine\n  const getBookData = (spineId: string) => {\n    const book = bookMatches.find(book => book.spine_region_id === spineId);\n    console.log('🔍 getBookData for spine:', spineId, 'found book:', book?.id, 'title:', book?.title);\n    return book;\n  };\n\n  // Handle spine region click\n  const handleSpineClick = (spineId: string) => {\n    if (editingState.mode === 'drawing') return; // Don't select while drawing\n    onSpineSelected(spineId);\n  };\n\n  // Handle spine region hover\n  const handleSpineHover = (spineId: string | null) => {\n    if (editingState.mode === 'drawing') return; // Don't hover while drawing\n    setHoveredSpineId(spineId);\n  };\n\n  // Start editing mode for a spine\n  const startEditing = (spineId: string) => {\n    setEditingState({\n      mode: 'editing',\n      spineId,\n      vertexIndex: null,\n      isDragging: false\n    });\n  };\n\n  // Start drawing mode for manual entry\n  const startDrawing = (spineId: string) => {\n    setEditingState({\n      mode: 'drawing',\n      spineId,\n      vertexIndex: null,\n      isDragging: false\n    });\n    setDrawingPoints([]);\n  };\n\n  // Cancel editing/drawing mode\n  const cancelEditing = () => {\n    setEditingState({\n      mode: 'none',\n      spineId: null,\n      vertexIndex: null,\n      isDragging: false\n    });\n    setDrawingPoints([]);\n  };\n\n  // Save manual drawing\n  const saveManualDrawing = () => {\n    if (drawingPoints.length >= 3 && onManualSpineAdded && editingBookId) {\n      const newSpine: SpineRegion = {\n        id: `manual_${Date.now()}`,\n        x: Math.min(...drawingPoints.map(p => p[0])),\n        y: Math.min(...drawingPoints.map(p => p[1])),\n        width: Math.max(...drawingPoints.map(p => p[0])) - Math.min(...drawingPoints.map(p => p[0])),\n        height: Math.max(...drawingPoints.map(p => p[1])) - Math.min(...drawingPoints.map(p => p[1])),\n        rotation: 0,\n        confidence: 0.9,\n        coordinates: drawingPoints\n      };\n      \n      onManualSpineAdded(newSpine);\n      cancelEditing();\n    }\n  };\n\n  // Handle SVG click for drawing\n  const handleSvgClick = (event: React.MouseEvent<SVGSVGElement>) => {\n    if (editingState.mode !== 'drawing') return;\n    \n    const svg = svgRef.current;\n    if (!svg) return;\n    \n    const rect = svg.getBoundingClientRect();\n    const x = event.clientX - rect.left;\n    const y = event.clientY - rect.top;\n    \n    const imageCoords = getImageCoordinates(x, y);\n    setDrawingPoints(prev => [...prev, imageCoords]);\n  };\n\n  // Handle vertex drag start\n  const handleVertexDragStart = (spineId: string, vertexIndex: number) => {\n    setEditingState(prev => ({\n      ...prev,\n      mode: 'editing',\n      spineId,\n      vertexIndex,\n      isDragging: true\n    }));\n  };\n\n  // Handle vertex drag\n  const handleVertexDrag = useCallback((spineId: string, vertexIndex: number, newX: number, newY: number) => {\n    if (!onSpineRegionsUpdated) return;\n    \n    const imageCoords = getImageCoordinates(newX, newY);\n    const updatedRegions = spineRegions.map(spine => {\n      if (spine.id === spineId && spine.coordinates) {\n        const newCoordinates = [...spine.coordinates];\n        newCoordinates[vertexIndex] = imageCoords;\n        return { ...spine, coordinates: newCoordinates };\n      }\n      return spine;\n    });\n    \n    onSpineRegionsUpdated(updatedRegions);\n  }, [spineRegions, onSpineRegionsUpdated, imageScale]);\n\n  // Handle mouse move for vertex dragging\n  const handleMouseMove = useCallback((event: React.MouseEvent<SVGSVGElement>) => {\n    if (editingState.mode !== 'editing' || !editingState.isDragging || !editingState.spineId || editingState.vertexIndex === null) return;\n    \n    const svg = svgRef.current;\n    if (!svg) return;\n    \n    const rect = svg.getBoundingClientRect();\n    const x = event.clientX - rect.left;\n    const y = event.clientY - rect.top;\n    \n    handleVertexDrag(editingState.spineId, editingState.vertexIndex, x, y);\n  }, [editingState, handleVertexDrag]);\n\n  // Handle vertex drag end\n  const handleVertexDragEnd = () => {\n    setEditingState(prev => ({\n      ...prev,\n      isDragging: false\n    }));\n  };\n\n  // Render vertex handles for editing\n  const renderVertexHandles = (spine: SpineRegion) => {\n    if (editingState.mode !== 'editing' || editingState.spineId !== spine.id) return null;\n    \n    return spine.coordinates?.map((coord, index) => {\n      const [x, y] = coord;\n      const svgX = x * imageScale.scaleX;\n      const svgY = y * imageScale.scaleY;\n      \n      return (\n        <circle\n          key={`vertex-${spine.id}-${index}`}\n          cx={svgX}\n          cy={svgY}\n          r={6}\n          fill=\"#FF6B6B\"\n          stroke=\"#FF4757\"\n          strokeWidth={2}\n          cursor=\"move\"\n          onMouseDown={(e) => {\n            e.stopPropagation();\n            handleVertexDragStart(spine.id, index);\n          }}\n          onMouseUp={handleVertexDragEnd}\n          style={{ pointerEvents: editingState.isDragging ? 'none' : 'auto' }}\n        />\n      );\n    });\n  };\n\n  // Render drawing points\n  const renderDrawingPoints = () => {\n    if (editingState.mode !== 'drawing' || drawingPoints.length === 0) return null;\n    \n    return (\n      <g>\n        {/* Draw lines between points */}\n        {drawingPoints.length > 1 && (\n          <polyline\n            points={drawingPoints.map(([x, y]) => `${x * imageScale.scaleX},${y * imageScale.scaleY}`).join(' ')}\n            fill=\"none\"\n            stroke=\"#FF6B6B\"\n            strokeWidth={2}\n            strokeDasharray=\"5,5\"\n          />\n        )}\n        \n        {/* Draw vertex points */}\n        {drawingPoints.map(([x, y], index) => (\n          <circle\n            key={`drawing-${index}`}\n            cx={x * imageScale.scaleX}\n            cy={y * imageScale.scaleY}\n            r={4}\n            fill=\"#FF6B6B\"\n            stroke=\"#FF4757\"\n            strokeWidth={2}\n          />\n        ))}\n      </g>\n    );\n  };\n\n  // Render spine region as polygon within an SVG aligned to the image\n  const renderSpineRegion = (spine: SpineRegion) => {\n    const book = getBookData(spine.id);\n    const points = getScaledPoints(spine);\n    const { x: cx, y: cy } = getCentroid(spine);\n    const isSelected = selectedSpineId === spine.id;\n    const isHovered = hoveredSpineId === spine.id;\n    const isEditing = editingState.mode === 'editing' && editingState.spineId === spine.id;\n    const isDrawing = editingState.mode === 'drawing' && editingState.spineId === spine.id;\n    const hasSelection = selectedSpineId !== null;\n    const isOtherSelected = hasSelection && !isSelected;\n\n    // Debug logging\n    console.log('🔍 Rendering spine:', spine.id, 'editingBookId:', editingBookId, 'book?.spine_region_id:', book?.spine_region_id);\n\n    // Only show spines that are being edited or not in editing mode\n    if (editingBookId && !isEditing && !isDrawing) {\n      // Check if this spine belongs to the book being edited\n      const isTargetBook = book && book.id === editingBookId;\n      if (!isTargetBook) {\n        console.log('🚫 Hiding spine:', spine.id, 'because it\\'s not the editing target book');\n        return null;\n      }\n    }\n\n    const fill = isEditing || isDrawing ? 'rgba(255,107,107,0.3)' : \n                 isSelected ? 'rgba(59,130,246,0.25)' : \n                 isHovered ? 'rgba(59,130,246,0.18)' : \n                 'rgba(59,130,246,0.12)';\n    const stroke = isEditing || isDrawing ? '#FF6B6B' :\n                  isSelected ? '#60A5FA' : \n                  isHovered ? '#3B82F6' : \n                  '#2563EB';\n    const opacity = isOtherSelected && !isEditing && !isDrawing ? 0.35 : 1;\n\n    return (\n      <g key={spine.id} style={{ opacity }}\n         onMouseEnter={() => handleSpineHover(spine.id)}\n         onMouseLeave={() => handleSpineHover(null)}\n         onClick={() => handleSpineClick(spine.id)}\n      >\n        <polygon points={points} fill={fill} stroke={stroke} strokeWidth={2} />\n        \n        {/* Spine number label at centroid */}\n        <text x={cx} y={cy} textAnchor=\"middle\" dominantBaseline=\"middle\" fill=\"#fff\" fontSize={12} fontWeight={600}>\n          {spineRegions.findIndex(s => s.id === spine.id) + 1}\n        </text>\n        \n\n        \n        {/* Vertex handles for editing */}\n        {renderVertexHandles(spine)}\n        \n        {/* Tooltip near centroid */}\n        {hoveredSpineId === spine.id && book && overlayRect && !isEditing && (\n          <foreignObject x={Math.min(Math.max(cx + 8, 0), overlayRect.width - 200)} y={Math.max(cy - 40, 0)} width={200} height={80}>\n            <div className=\"bg-gray-900 text-white text-xs px-3 py-2 rounded-lg shadow-lg\" style={{ pointerEvents: 'none' }}>\n              <div className=\"font-medium mb-1 truncate\">{book.title}</div>\n              <div className=\"text-gray-300 truncate\">by {Array.isArray(book.author_name) ? book.author_name.join(', ') : book.author_name || 'Unknown Author'}</div>\n              {book.first_publish_year && (\n                <div className=\"text-gray-400\">{book.first_publish_year}</div>\n              )}\n            </div>\n          </foreignObject>\n        )}\n      </g>\n    );\n  };\n\n  return (\n    <div className=\"card p-0 overflow-hidden\">\n      {/* Header */}\n      <div className=\"p-6 border-b border-gray-200\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n              Book Spine Detection\n            </h3>\n            <p className=\"text-sm text-gray-600\">\n              {spineRegions.length} spine{spineRegions.length !== 1 ? 's' : ''} detected\n              {bookMatches.length > 0 && ` • ${bookMatches.length} book${bookMatches.length !== 1 ? 's' : ''} identified`}\n            </p>\n          </div>\n          \n          {/* Editing Controls */}\n          {!isFinalized && (\n            <div className=\"flex items-center space-x-2\">\n                             {editingState.mode === 'none' && editingBookId && (\n                 <>\n                   <button\n                     onClick={() => startDrawing(editingBookId)}\n                     className=\"btn-secondary text-sm px-3 py-1 flex items-center space-x-1\"\n                   >\n                     <Plus className=\"w-4 h-4\" />\n                     <span>Draw OBB</span>\n                   </button>\n                 </>\n               )}\n              \n              {editingState.mode === 'drawing' && (\n                <>\n                  <button\n                    onClick={saveManualDrawing}\n                    disabled={drawingPoints.length < 3}\n                    className=\"btn-primary text-sm px-3 py-1 flex items-center space-x-1 disabled:opacity-50\"\n                  >\n                    <Save className=\"w-4 h-4\" />\n                    <span>Save OBB</span>\n                  </button>\n                  <button\n                    onClick={cancelEditing}\n                    className=\"btn-danger text-sm px-3 py-1 flex items-center space-x-1\"\n                  >\n                    <X className=\"w-4 h-4\" />\n                    <span>Cancel</span>\n                  </button>\n                </>\n              )}\n              \n                            {editingState.mode === 'editing' && (\n                <>\n                  <button\n                    onClick={() => startDrawing(editingBookId || '')}\n                    className=\"btn-secondary text-sm px-3 py-1 flex items-center space-x-1\"\n                  >\n                    <Plus className=\"w-4 h-4\" />\n                    <span>Draw New OBB</span>\n                  </button>\n                  <button\n                    onClick={cancelEditing}\n                    className=\"btn-secondary text-sm px-3 py-1 flex items-center space-x-1\"\n                  >\n                    <Move className=\"w-4 h-4\" />\n                    <span>Drag vertices to edit</span>\n                  </button>\n                  <button\n                    onClick={() => {\n                      cancelEditing();\n                      if (onStopEditing) onStopEditing();\n                    }}\n                    className=\"btn-primary text-sm px-3 py-1 flex items-center space-x-1\"\n                  >\n                    <Save className=\"w-4 h-4\" />\n                    <span>Done</span>\n                  </button>\n                </>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Image Container */}\n      <div \n        ref={containerRef}\n        className=\"relative bg-gray-100 min-h-[400px] flex items-center justify-center\"\n      >\n        {!imageLoaded && (\n          <div className=\"text-center text-gray-500\">\n            <BookOpen className=\"w-12 h-12 mx-auto mb-2 text-gray-400\" />\n            <p>Loading image...</p>\n          </div>\n        )}\n\n        {/* Main Image */}\n        <img\n          ref={imageRef}\n          src={imageUrl}\n          alt=\"Book spines\"\n          className=\"max-w-full max-h-[600px] object-contain\"\n          onLoad={() => setImageLoaded(true)}\n          onError={() => setImageLoaded(false)}\n        />\n\n        {/* Spine Regions Overlay */}\n        {imageLoaded && overlayRect && (\n          <svg\n            ref={svgRef}\n            className=\"absolute cursor-crosshair\"\n            style={{ left: overlayRect.left, top: overlayRect.top }}\n            width={overlayRect.width}\n            height={overlayRect.height}\n            onClick={handleSvgClick}\n            onMouseMove={handleMouseMove}\n            onMouseUp={handleVertexDragEnd}\n          >\n            {spineRegions.map(renderSpineRegion)}\n            {renderDrawingPoints()}\n          </svg>\n        )}\n\n        {/* No Spines Detected */}\n        {imageLoaded && spineRegions.length === 0 && editingState.mode !== 'drawing' && (\n          <div className=\"absolute inset-0 flex items-center justify-center bg-white bg-opacity-90\">\n            <div className=\"text-center text-gray-500\">\n              <AlertCircle className=\"w-12 h-12 mx-auto mb-2 text-gray-400\" />\n              <p className=\"text-lg font-medium\">No book spines detected</p>\n              <p className=\"text-sm\">Try uploading a clearer image or draw spines manually</p>\n            </div>\n          </div>\n        )}\n\n        {/* Drawing Instructions */}\n        {imageLoaded && editingState.mode === 'drawing' && (\n          <div className=\"absolute top-4 left-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg\">\n            <p className=\"text-sm font-medium\">Click to add vertices. Need at least 3 points.</p>\n            <p className=\"text-xs opacity-90\">Click \"Save OBB\" when done</p>\n          </div>\n        )}\n      </div>\n\n      {/* Legend */}\n      {spineRegions.length > 0 && (\n        <div className=\"p-4 bg-gray-50 border-t border-gray-200\">\n          <div className=\"flex items-center justify-between text-sm text-gray-600\">\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"w-3 h-3 bg-primary-500 rounded\"></div>\n                <span>Detected spine</span>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"w-3 h-3 bg-primary-600 rounded ring-2 ring-primary-400\"></div>\n                <span>Selected</span>\n              </div>\n              {!isFinalized && (\n                <>\n                  <div className=\"flex items-center space-x-2\">\n                    <div className=\"w-3 h-3 bg-red-500 rounded\"></div>\n                    <span>Editing</span>\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    <div className=\"w-3 h-3 bg-red-400 rounded\"></div>\n                    <span>Drawing</span>\n                  </div>\n                </>\n              )}\n            </div>\n            \n            <div className=\"text-xs\">\n              {editingState.mode === 'none' && 'Click on spine regions to select books'}\n              {editingState.mode === 'drawing' && 'Click on image to draw spine outline'}\n              {editingState.mode === 'editing' && 'Drag red vertices to edit spine shape'}\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default SpineVisualizer;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}