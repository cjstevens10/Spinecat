{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\coope\\\\CursorWorkspace\\\\Spinecat\\\\web_interface\\\\src\\\\components\\\\SpineVisualizer.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect, useCallback } from 'react';\nimport { BookOpen, AlertCircle, Plus, Save, X, Move } from 'lucide-react';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst SpineVisualizer = ({\n  imageUrl,\n  spineRegions,\n  bookMatches,\n  selectedSpineId,\n  onSpineSelected,\n  isFinalized,\n  onSpineRegionsUpdated,\n  onManualSpineAdded,\n  editingBookId\n}) => {\n  _s();\n  const [imageLoaded, setImageLoaded] = useState(false);\n  const [hoveredSpineId, setHoveredSpineId] = useState(null);\n  const [imageScale, setImageScale] = useState({\n    scaleX: 1,\n    scaleY: 1,\n    offsetX: 0,\n    offsetY: 0\n  });\n  const [overlayRect, setOverlayRect] = useState(null);\n  const [editingState, setEditingState] = useState({\n    mode: 'none',\n    spineId: null,\n    vertexIndex: null,\n    isDragging: false\n  });\n  const [drawingPoints, setDrawingPoints] = useState([]);\n  const imageRef = useRef(null);\n  const containerRef = useRef(null);\n  const svgRef = useRef(null);\n\n  // Calculate image scale and offset when image loads\n  useEffect(() => {\n    if (imageRef.current && imageLoaded) {\n      const img = imageRef.current;\n      const container = containerRef.current;\n      if (container) {\n        const containerRect = container.getBoundingClientRect();\n        const imgRect = img.getBoundingClientRect();\n\n        // Calculate scale factors\n        const scaleX = imgRect.width / img.naturalWidth;\n        const scaleY = imgRect.height / img.naturalHeight;\n\n        // Calculate offset (difference between container and image positioning)\n        const offsetX = imgRect.left - containerRect.left;\n        const offsetY = imgRect.top - containerRect.top;\n        setImageScale({\n          scaleX,\n          scaleY,\n          offsetX,\n          offsetY\n        });\n        setOverlayRect({\n          left: offsetX,\n          top: offsetY,\n          width: imgRect.width,\n          height: imgRect.height\n        });\n      }\n    }\n  }, [imageLoaded]);\n\n  // Convert spine polygon to scaled SVG points string\n  const getScaledPoints = spine => {\n    if (!spine.coordinates || spine.coordinates.length === 0) return '';\n    return spine.coordinates.map(([x, y]) => {\n      const sx = x * imageScale.scaleX;\n      const sy = y * imageScale.scaleY;\n      return `${sx},${sy}`;\n    }).join(' ');\n  };\n\n  // Convert SVG coordinates back to image coordinates\n  const getImageCoordinates = (svgX, svgY) => {\n    return [svgX / imageScale.scaleX, svgY / imageScale.scaleY];\n  };\n\n  // Compute centroid for label/tooltip positioning within overlay\n  const getCentroid = spine => {\n    if (!spine.coordinates || spine.coordinates.length === 0) return {\n      x: 0,\n      y: 0\n    };\n    const pts = spine.coordinates;\n    const cx = pts.reduce((a, p) => a + p[0], 0) / pts.length;\n    const cy = pts.reduce((a, p) => a + p[1], 0) / pts.length;\n    return {\n      x: cx * imageScale.scaleX,\n      y: cy * imageScale.scaleY\n    };\n  };\n\n  // Helper function to get spine region by ID\n  const getSpineRegion = id => {\n    return spineRegions.find(spine => spine.id === id);\n  };\n\n  // Helper function to get book data for a spine\n  const getBookData = spineId => {\n    return bookMatches.find(book => book.spine_region_id === spineId);\n  };\n\n  // Handle spine region click\n  const handleSpineClick = spineId => {\n    if (editingState.mode === 'drawing') return; // Don't select while drawing\n    onSpineSelected(spineId);\n  };\n\n  // Handle spine region hover\n  const handleSpineHover = spineId => {\n    if (editingState.mode === 'drawing') return; // Don't hover while drawing\n    setHoveredSpineId(spineId);\n  };\n\n  // Start editing mode for a spine\n  const startEditing = spineId => {\n    setEditingState({\n      mode: 'editing',\n      spineId,\n      vertexIndex: null,\n      isDragging: false\n    });\n  };\n\n  // Start drawing mode for manual entry\n  const startDrawing = spineId => {\n    setEditingState({\n      mode: 'drawing',\n      spineId,\n      vertexIndex: null,\n      isDragging: false\n    });\n    setDrawingPoints([]);\n  };\n\n  // Cancel editing/drawing mode\n  const cancelEditing = () => {\n    setEditingState({\n      mode: 'none',\n      spineId: null,\n      vertexIndex: null,\n      isDragging: false\n    });\n    setDrawingPoints([]);\n  };\n\n  // Save manual drawing\n  const saveManualDrawing = () => {\n    if (drawingPoints.length >= 3 && onManualSpineAdded) {\n      const newSpine = {\n        id: `manual_${Date.now()}`,\n        x: Math.min(...drawingPoints.map(p => p[0])),\n        y: Math.min(...drawingPoints.map(p => p[1])),\n        width: Math.max(...drawingPoints.map(p => p[0])) - Math.min(...drawingPoints.map(p => p[0])),\n        height: Math.max(...drawingPoints.map(p => p[1])) - Math.min(...drawingPoints.map(p => p[1])),\n        rotation: 0,\n        confidence: 0.9,\n        coordinates: drawingPoints\n      };\n      onManualSpineAdded(newSpine);\n      cancelEditing();\n    }\n  };\n\n  // Handle SVG click for drawing\n  const handleSvgClick = event => {\n    if (editingState.mode !== 'drawing') return;\n    const svg = svgRef.current;\n    if (!svg) return;\n    const rect = svg.getBoundingClientRect();\n    const x = event.clientX - rect.left;\n    const y = event.clientY - rect.top;\n    const imageCoords = getImageCoordinates(x, y);\n    setDrawingPoints(prev => [...prev, imageCoords]);\n  };\n\n  // Handle vertex drag start\n  const handleVertexDragStart = (spineId, vertexIndex) => {\n    setEditingState(prev => ({\n      ...prev,\n      mode: 'editing',\n      spineId,\n      vertexIndex,\n      isDragging: true\n    }));\n  };\n\n  // Handle vertex drag\n  const handleVertexDrag = useCallback((spineId, vertexIndex, newX, newY) => {\n    if (!onSpineRegionsUpdated) return;\n    const imageCoords = getImageCoordinates(newX, newY);\n    const updatedRegions = spineRegions.map(spine => {\n      if (spine.id === spineId && spine.coordinates) {\n        const newCoordinates = [...spine.coordinates];\n        newCoordinates[vertexIndex] = imageCoords;\n        return {\n          ...spine,\n          coordinates: newCoordinates\n        };\n      }\n      return spine;\n    });\n    onSpineRegionsUpdated(updatedRegions);\n  }, [spineRegions, onSpineRegionsUpdated, imageScale]);\n\n  // Handle mouse move for vertex dragging\n  const handleMouseMove = useCallback(event => {\n    if (editingState.mode !== 'editing' || !editingState.isDragging || !editingState.spineId || editingState.vertexIndex === null) return;\n    const svg = svgRef.current;\n    if (!svg) return;\n    const rect = svg.getBoundingClientRect();\n    const x = event.clientX - rect.left;\n    const y = event.clientY - rect.top;\n    handleVertexDrag(editingState.spineId, editingState.vertexIndex, x, y);\n  }, [editingState, handleVertexDrag]);\n\n  // Handle vertex drag end\n  const handleVertexDragEnd = () => {\n    setEditingState(prev => ({\n      ...prev,\n      isDragging: false\n    }));\n  };\n\n  // Render vertex handles for editing\n  const renderVertexHandles = spine => {\n    var _spine$coordinates;\n    if (editingState.mode !== 'editing' || editingState.spineId !== spine.id) return null;\n    return (_spine$coordinates = spine.coordinates) === null || _spine$coordinates === void 0 ? void 0 : _spine$coordinates.map((coord, index) => {\n      const [x, y] = coord;\n      const svgX = x * imageScale.scaleX;\n      const svgY = y * imageScale.scaleY;\n      return /*#__PURE__*/_jsxDEV(\"circle\", {\n        cx: svgX,\n        cy: svgY,\n        r: 6,\n        fill: \"#FF6B6B\",\n        stroke: \"#FF4757\",\n        strokeWidth: 2,\n        cursor: \"move\",\n        onMouseDown: e => {\n          e.stopPropagation();\n          handleVertexDragStart(spine.id, index);\n        },\n        onMouseUp: handleVertexDragEnd,\n        style: {\n          pointerEvents: editingState.isDragging ? 'none' : 'auto'\n        }\n      }, `vertex-${spine.id}-${index}`, false, {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 9\n      }, this);\n    });\n  };\n\n  // Render drawing points\n  const renderDrawingPoints = () => {\n    if (editingState.mode !== 'drawing' || drawingPoints.length === 0) return null;\n    return /*#__PURE__*/_jsxDEV(\"g\", {\n      children: [drawingPoints.length > 1 && /*#__PURE__*/_jsxDEV(\"polyline\", {\n        points: drawingPoints.map(([x, y]) => `${x * imageScale.scaleX},${y * imageScale.scaleY}`).join(' '),\n        fill: \"none\",\n        stroke: \"#FF6B6B\",\n        strokeWidth: 2,\n        strokeDasharray: \"5,5\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 279,\n        columnNumber: 11\n      }, this), drawingPoints.map(([x, y], index) => /*#__PURE__*/_jsxDEV(\"circle\", {\n        cx: x * imageScale.scaleX,\n        cy: y * imageScale.scaleY,\n        r: 4,\n        fill: \"#FF6B6B\",\n        stroke: \"#FF4757\",\n        strokeWidth: 2\n      }, `drawing-${index}`, false, {\n        fileName: _jsxFileName,\n        lineNumber: 290,\n        columnNumber: 11\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 276,\n      columnNumber: 7\n    }, this);\n  };\n\n  // Render spine region as polygon within an SVG aligned to the image\n  const renderSpineRegion = spine => {\n    const book = getBookData(spine.id);\n    const points = getScaledPoints(spine);\n    const {\n      x: cx,\n      y: cy\n    } = getCentroid(spine);\n    const isSelected = selectedSpineId === spine.id;\n    const isHovered = hoveredSpineId === spine.id;\n    const isEditing = editingState.mode === 'editing' && editingState.spineId === spine.id;\n    const isDrawing = editingState.mode === 'drawing' && editingState.spineId === spine.id;\n    const hasSelection = selectedSpineId !== null;\n    const isOtherSelected = hasSelection && !isSelected;\n\n    // Only show spines that are being edited or not in editing mode\n    if (editingBookId && !isEditing && !isDrawing && (book === null || book === void 0 ? void 0 : book.spine_region_id) !== editingBookId) {\n      return null;\n    }\n    const fill = isEditing || isDrawing ? 'rgba(255,107,107,0.3)' : isSelected ? 'rgba(59,130,246,0.25)' : isHovered ? 'rgba(59,130,246,0.18)' : 'rgba(59,130,246,0.12)';\n    const stroke = isEditing || isDrawing ? '#FF6B6B' : isSelected ? '#60A5FA' : isHovered ? '#3B82F6' : '#2563EB';\n    const opacity = isOtherSelected && !isEditing && !isDrawing ? 0.35 : 1;\n    return /*#__PURE__*/_jsxDEV(\"g\", {\n      style: {\n        opacity\n      },\n      onMouseEnter: () => handleSpineHover(spine.id),\n      onMouseLeave: () => handleSpineHover(null),\n      onClick: () => handleSpineClick(spine.id),\n      children: [/*#__PURE__*/_jsxDEV(\"polygon\", {\n        points: points,\n        fill: fill,\n        stroke: stroke,\n        strokeWidth: 2\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 337,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"text\", {\n        x: cx,\n        y: cy,\n        textAnchor: \"middle\",\n        dominantBaseline: \"middle\",\n        fill: \"#fff\",\n        fontSize: 12,\n        fontWeight: 600,\n        children: spineRegions.findIndex(s => s.id === spine.id) + 1\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 340,\n        columnNumber: 9\n      }, this), renderVertexHandles(spine), hoveredSpineId === spine.id && book && overlayRect && !isEditing && /*#__PURE__*/_jsxDEV(\"foreignObject\", {\n        x: Math.min(Math.max(cx + 8, 0), overlayRect.width - 200),\n        y: Math.max(cy - 40, 0),\n        width: 200,\n        height: 80,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-gray-900 text-white text-xs px-3 py-2 rounded-lg shadow-lg\",\n          style: {\n            pointerEvents: 'none'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"font-medium mb-1 truncate\",\n            children: book.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 353,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-gray-300 truncate\",\n            children: [\"by \", Array.isArray(book.author_name) ? book.author_name.join(', ') : book.author_name || 'Unknown Author']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 354,\n            columnNumber: 15\n          }, this), book.first_publish_year && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-gray-400\",\n            children: book.first_publish_year\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 356,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 352,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 351,\n        columnNumber: 11\n      }, this)]\n    }, spine.id, true, {\n      fileName: _jsxFileName,\n      lineNumber: 332,\n      columnNumber: 7\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"card p-0 overflow-hidden\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-6 border-b border-gray-200\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center justify-between\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"text-lg font-semibold text-gray-900 mb-2\",\n            children: \"Book Spine Detection\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 371,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm text-gray-600\",\n            children: [spineRegions.length, \" spine\", spineRegions.length !== 1 ? 's' : '', \" detected\", bookMatches.length > 0 && ` • ${bookMatches.length} book${bookMatches.length !== 1 ? 's' : ''} identified`]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 374,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 370,\n          columnNumber: 11\n        }, this), !isFinalized && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-2\",\n          children: [editingState.mode === 'none' && editingBookId && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => startDrawing(editingBookId),\n              className: \"btn-secondary text-sm px-3 py-1 flex items-center space-x-1\",\n              children: [/*#__PURE__*/_jsxDEV(Plus, {\n                className: \"w-4 h-4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 389,\n                columnNumber: 22\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Draw OBB\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 390,\n                columnNumber: 22\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 385,\n              columnNumber: 20\n            }, this)\n          }, void 0, false), editingState.mode === 'drawing' && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: saveManualDrawing,\n              disabled: drawingPoints.length < 3,\n              className: \"btn-primary text-sm px-3 py-1 flex items-center space-x-1 disabled:opacity-50\",\n              children: [/*#__PURE__*/_jsxDEV(Save, {\n                className: \"w-4 h-4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 402,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Save OBB\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 403,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 397,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: cancelEditing,\n              className: \"btn-danger text-sm px-3 py-1 flex items-center space-x-1\",\n              children: [/*#__PURE__*/_jsxDEV(X, {\n                className: \"w-4 h-4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 409,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Cancel\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 410,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 405,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true), editingState.mode === 'editing' && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: cancelEditing,\n              className: \"btn-secondary text-sm px-3 py-1 flex items-center space-x-1\",\n              children: [/*#__PURE__*/_jsxDEV(Move, {\n                className: \"w-4 h-4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 421,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Drag vertices to edit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 422,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 417,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: cancelEditing,\n              className: \"btn-primary text-sm px-3 py-1 flex items-center space-x-1\",\n              children: [/*#__PURE__*/_jsxDEV(Save, {\n                className: \"w-4 h-4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 428,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Done\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 429,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 424,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 382,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 369,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 368,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: containerRef,\n      className: \"relative bg-gray-100 min-h-[400px] flex items-center justify-center\",\n      children: [!imageLoaded && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center text-gray-500\",\n        children: [/*#__PURE__*/_jsxDEV(BookOpen, {\n          className: \"w-12 h-12 mx-auto mb-2 text-gray-400\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 445,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Loading image...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 446,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 444,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n        ref: imageRef,\n        src: imageUrl,\n        alt: \"Book spines\",\n        className: \"max-w-full max-h-[600px] object-contain\",\n        onLoad: () => setImageLoaded(true),\n        onError: () => setImageLoaded(false)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 451,\n        columnNumber: 9\n      }, this), imageLoaded && overlayRect && /*#__PURE__*/_jsxDEV(\"svg\", {\n        ref: svgRef,\n        className: \"absolute cursor-crosshair\",\n        style: {\n          left: overlayRect.left,\n          top: overlayRect.top\n        },\n        width: overlayRect.width,\n        height: overlayRect.height,\n        onClick: handleSvgClick,\n        onMouseMove: handleMouseMove,\n        onMouseUp: handleVertexDragEnd,\n        children: [spineRegions.map(renderSpineRegion), renderDrawingPoints()]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 462,\n        columnNumber: 11\n      }, this), imageLoaded && spineRegions.length === 0 && editingState.mode !== 'drawing' && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute inset-0 flex items-center justify-center bg-white bg-opacity-90\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-center text-gray-500\",\n          children: [/*#__PURE__*/_jsxDEV(AlertCircle, {\n            className: \"w-12 h-12 mx-auto mb-2 text-gray-400\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 481,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-lg font-medium\",\n            children: \"No book spines detected\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 482,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm\",\n            children: \"Try uploading a clearer image or draw spines manually\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 483,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 480,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 479,\n        columnNumber: 11\n      }, this), imageLoaded && editingState.mode === 'drawing' && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute top-4 left-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-sm font-medium\",\n          children: \"Click to add vertices. Need at least 3 points.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 491,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-xs opacity-90\",\n          children: \"Click \\\"Save OBB\\\" when done\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 492,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 490,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 439,\n      columnNumber: 7\n    }, this), spineRegions.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"p-4 bg-gray-50 border-t border-gray-200\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center justify-between text-sm text-gray-600\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center space-x-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center space-x-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-3 h-3 bg-primary-500 rounded\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 503,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Detected spine\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 504,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 502,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center space-x-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-3 h-3 bg-primary-600 rounded ring-2 ring-primary-400\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 507,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Selected\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 508,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 506,\n            columnNumber: 15\n          }, this), !isFinalized && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center space-x-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"w-3 h-3 bg-red-500 rounded\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 513,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Editing\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 514,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 512,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center space-x-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"w-3 h-3 bg-red-400 rounded\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 517,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Drawing\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 518,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 516,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 501,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-xs\",\n          children: [editingState.mode === 'none' && 'Click on spine regions to select books', editingState.mode === 'drawing' && 'Click on image to draw spine outline', editingState.mode === 'editing' && 'Drag red vertices to edit spine shape']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 524,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 500,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 499,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 366,\n    columnNumber: 5\n  }, this);\n};\n_s(SpineVisualizer, \"/764WChxFMp323yi+A+hR5WXECY=\");\n_c = SpineVisualizer;\nexport default SpineVisualizer;\nvar _c;\n$RefreshReg$(_c, \"SpineVisualizer\");","map":{"version":3,"names":["React","useState","useRef","useEffect","useCallback","BookOpen","AlertCircle","Plus","Save","X","Move","jsxDEV","_jsxDEV","Fragment","_Fragment","SpineVisualizer","imageUrl","spineRegions","bookMatches","selectedSpineId","onSpineSelected","isFinalized","onSpineRegionsUpdated","onManualSpineAdded","editingBookId","_s","imageLoaded","setImageLoaded","hoveredSpineId","setHoveredSpineId","imageScale","setImageScale","scaleX","scaleY","offsetX","offsetY","overlayRect","setOverlayRect","editingState","setEditingState","mode","spineId","vertexIndex","isDragging","drawingPoints","setDrawingPoints","imageRef","containerRef","svgRef","current","img","container","containerRect","getBoundingClientRect","imgRect","width","naturalWidth","height","naturalHeight","left","top","getScaledPoints","spine","coordinates","length","map","x","y","sx","sy","join","getImageCoordinates","svgX","svgY","getCentroid","pts","cx","reduce","a","p","cy","getSpineRegion","id","find","getBookData","book","spine_region_id","handleSpineClick","handleSpineHover","startEditing","startDrawing","cancelEditing","saveManualDrawing","newSpine","Date","now","Math","min","max","rotation","confidence","handleSvgClick","event","svg","rect","clientX","clientY","imageCoords","prev","handleVertexDragStart","handleVertexDrag","newX","newY","updatedRegions","newCoordinates","handleMouseMove","handleVertexDragEnd","renderVertexHandles","_spine$coordinates","coord","index","r","fill","stroke","strokeWidth","cursor","onMouseDown","e","stopPropagation","onMouseUp","style","pointerEvents","fileName","_jsxFileName","lineNumber","columnNumber","renderDrawingPoints","children","points","strokeDasharray","renderSpineRegion","isSelected","isHovered","isEditing","isDrawing","hasSelection","isOtherSelected","opacity","onMouseEnter","onMouseLeave","onClick","textAnchor","dominantBaseline","fontSize","fontWeight","findIndex","s","className","title","Array","isArray","author_name","first_publish_year","disabled","ref","src","alt","onLoad","onError","onMouseMove","_c","$RefreshReg$"],"sources":["C:/Users/coope/CursorWorkspace/Spinecat/web_interface/src/components/SpineVisualizer.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from 'react';\nimport { motion } from 'framer-motion';\nimport { BookOpen, AlertCircle, Edit3, Plus, Save, X, Move } from 'lucide-react';\n\nimport { SpineRegion, BookMatch } from '../types';\n\ninterface SpineVisualizerProps {\n  imageUrl: string;\n  spineRegions: SpineRegion[];\n  bookMatches: BookMatch[];\n  selectedSpineId: string | null;\n  onSpineSelected: (spineId: string) => void;\n  isFinalized: boolean;\n  onSpineRegionsUpdated?: (updatedRegions: SpineRegion[]) => void;\n  onManualSpineAdded?: (newSpine: SpineRegion) => void;\n  editingBookId?: string | null; // ID of the book being edited\n}\n\ninterface EditingState {\n  mode: 'none' | 'drawing' | 'editing';\n  spineId: string | null;\n  vertexIndex: number | null;\n  isDragging: boolean;\n}\n\nconst SpineVisualizer: React.FC<SpineVisualizerProps> = ({\n  imageUrl,\n  spineRegions,\n  bookMatches,\n  selectedSpineId,\n  onSpineSelected,\n  isFinalized,\n  onSpineRegionsUpdated,\n  onManualSpineAdded,\n  editingBookId\n}) => {\n  const [imageLoaded, setImageLoaded] = useState(false);\n  const [hoveredSpineId, setHoveredSpineId] = useState<string | null>(null);\n  const [imageScale, setImageScale] = useState({ scaleX: 1, scaleY: 1, offsetX: 0, offsetY: 0 });\n  const [overlayRect, setOverlayRect] = useState<{ left: number; top: number; width: number; height: number } | null>(null);\n  const [editingState, setEditingState] = useState<EditingState>({\n    mode: 'none',\n    spineId: null,\n    vertexIndex: null,\n    isDragging: false\n  });\n  const [drawingPoints, setDrawingPoints] = useState<[number, number][]>([]);\n  \n  const imageRef = useRef<HTMLImageElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const svgRef = useRef<SVGSVGElement>(null);\n\n  // Calculate image scale and offset when image loads\n  useEffect(() => {\n    if (imageRef.current && imageLoaded) {\n      const img = imageRef.current;\n      const container = containerRef.current;\n      \n      if (container) {\n        const containerRect = container.getBoundingClientRect();\n        const imgRect = img.getBoundingClientRect();\n        \n        // Calculate scale factors\n        const scaleX = imgRect.width / img.naturalWidth;\n        const scaleY = imgRect.height / img.naturalHeight;\n        \n        // Calculate offset (difference between container and image positioning)\n        const offsetX = imgRect.left - containerRect.left;\n        const offsetY = imgRect.top - containerRect.top;\n        \n        setImageScale({ scaleX, scaleY, offsetX, offsetY });\n        setOverlayRect({ left: offsetX, top: offsetY, width: imgRect.width, height: imgRect.height });\n      }\n    }\n  }, [imageLoaded]);\n\n  // Convert spine polygon to scaled SVG points string\n  const getScaledPoints = (spine: SpineRegion) => {\n    if (!spine.coordinates || spine.coordinates.length === 0) return '';\n    return spine.coordinates\n      .map(([x, y]) => {\n        const sx = x * imageScale.scaleX;\n        const sy = y * imageScale.scaleY;\n        return `${sx},${sy}`;\n      })\n      .join(' ');\n  };\n\n  // Convert SVG coordinates back to image coordinates\n  const getImageCoordinates = (svgX: number, svgY: number): [number, number] => {\n    return [svgX / imageScale.scaleX, svgY / imageScale.scaleY];\n  };\n\n  // Compute centroid for label/tooltip positioning within overlay\n  const getCentroid = (spine: SpineRegion) => {\n    if (!spine.coordinates || spine.coordinates.length === 0) return { x: 0, y: 0 };\n    const pts = spine.coordinates;\n    const cx = pts.reduce((a, p) => a + p[0], 0) / pts.length;\n    const cy = pts.reduce((a, p) => a + p[1], 0) / pts.length;\n    return { x: cx * imageScale.scaleX, y: cy * imageScale.scaleY };\n  };\n\n  // Helper function to get spine region by ID\n  const getSpineRegion = (id: string) => {\n    return spineRegions.find(spine => spine.id === id);\n  };\n\n  // Helper function to get book data for a spine\n  const getBookData = (spineId: string) => {\n    return bookMatches.find(book => book.spine_region_id === spineId);\n  };\n\n  // Handle spine region click\n  const handleSpineClick = (spineId: string) => {\n    if (editingState.mode === 'drawing') return; // Don't select while drawing\n    onSpineSelected(spineId);\n  };\n\n  // Handle spine region hover\n  const handleSpineHover = (spineId: string | null) => {\n    if (editingState.mode === 'drawing') return; // Don't hover while drawing\n    setHoveredSpineId(spineId);\n  };\n\n  // Start editing mode for a spine\n  const startEditing = (spineId: string) => {\n    setEditingState({\n      mode: 'editing',\n      spineId,\n      vertexIndex: null,\n      isDragging: false\n    });\n  };\n\n  // Start drawing mode for manual entry\n  const startDrawing = (spineId: string) => {\n    setEditingState({\n      mode: 'drawing',\n      spineId,\n      vertexIndex: null,\n      isDragging: false\n    });\n    setDrawingPoints([]);\n  };\n\n  // Cancel editing/drawing mode\n  const cancelEditing = () => {\n    setEditingState({\n      mode: 'none',\n      spineId: null,\n      vertexIndex: null,\n      isDragging: false\n    });\n    setDrawingPoints([]);\n  };\n\n  // Save manual drawing\n  const saveManualDrawing = () => {\n    if (drawingPoints.length >= 3 && onManualSpineAdded) {\n      const newSpine: SpineRegion = {\n        id: `manual_${Date.now()}`,\n        x: Math.min(...drawingPoints.map(p => p[0])),\n        y: Math.min(...drawingPoints.map(p => p[1])),\n        width: Math.max(...drawingPoints.map(p => p[0])) - Math.min(...drawingPoints.map(p => p[0])),\n        height: Math.max(...drawingPoints.map(p => p[1])) - Math.min(...drawingPoints.map(p => p[1])),\n        rotation: 0,\n        confidence: 0.9,\n        coordinates: drawingPoints\n      };\n      \n      onManualSpineAdded(newSpine);\n      cancelEditing();\n    }\n  };\n\n  // Handle SVG click for drawing\n  const handleSvgClick = (event: React.MouseEvent<SVGSVGElement>) => {\n    if (editingState.mode !== 'drawing') return;\n    \n    const svg = svgRef.current;\n    if (!svg) return;\n    \n    const rect = svg.getBoundingClientRect();\n    const x = event.clientX - rect.left;\n    const y = event.clientY - rect.top;\n    \n    const imageCoords = getImageCoordinates(x, y);\n    setDrawingPoints(prev => [...prev, imageCoords]);\n  };\n\n  // Handle vertex drag start\n  const handleVertexDragStart = (spineId: string, vertexIndex: number) => {\n    setEditingState(prev => ({\n      ...prev,\n      mode: 'editing',\n      spineId,\n      vertexIndex,\n      isDragging: true\n    }));\n  };\n\n  // Handle vertex drag\n  const handleVertexDrag = useCallback((spineId: string, vertexIndex: number, newX: number, newY: number) => {\n    if (!onSpineRegionsUpdated) return;\n    \n    const imageCoords = getImageCoordinates(newX, newY);\n    const updatedRegions = spineRegions.map(spine => {\n      if (spine.id === spineId && spine.coordinates) {\n        const newCoordinates = [...spine.coordinates];\n        newCoordinates[vertexIndex] = imageCoords;\n        return { ...spine, coordinates: newCoordinates };\n      }\n      return spine;\n    });\n    \n    onSpineRegionsUpdated(updatedRegions);\n  }, [spineRegions, onSpineRegionsUpdated, imageScale]);\n\n  // Handle mouse move for vertex dragging\n  const handleMouseMove = useCallback((event: React.MouseEvent<SVGSVGElement>) => {\n    if (editingState.mode !== 'editing' || !editingState.isDragging || !editingState.spineId || editingState.vertexIndex === null) return;\n    \n    const svg = svgRef.current;\n    if (!svg) return;\n    \n    const rect = svg.getBoundingClientRect();\n    const x = event.clientX - rect.left;\n    const y = event.clientY - rect.top;\n    \n    handleVertexDrag(editingState.spineId, editingState.vertexIndex, x, y);\n  }, [editingState, handleVertexDrag]);\n\n  // Handle vertex drag end\n  const handleVertexDragEnd = () => {\n    setEditingState(prev => ({\n      ...prev,\n      isDragging: false\n    }));\n  };\n\n  // Render vertex handles for editing\n  const renderVertexHandles = (spine: SpineRegion) => {\n    if (editingState.mode !== 'editing' || editingState.spineId !== spine.id) return null;\n    \n    return spine.coordinates?.map((coord, index) => {\n      const [x, y] = coord;\n      const svgX = x * imageScale.scaleX;\n      const svgY = y * imageScale.scaleY;\n      \n      return (\n        <circle\n          key={`vertex-${spine.id}-${index}`}\n          cx={svgX}\n          cy={svgY}\n          r={6}\n          fill=\"#FF6B6B\"\n          stroke=\"#FF4757\"\n          strokeWidth={2}\n          cursor=\"move\"\n          onMouseDown={(e) => {\n            e.stopPropagation();\n            handleVertexDragStart(spine.id, index);\n          }}\n          onMouseUp={handleVertexDragEnd}\n          style={{ pointerEvents: editingState.isDragging ? 'none' : 'auto' }}\n        />\n      );\n    });\n  };\n\n  // Render drawing points\n  const renderDrawingPoints = () => {\n    if (editingState.mode !== 'drawing' || drawingPoints.length === 0) return null;\n    \n    return (\n      <g>\n        {/* Draw lines between points */}\n        {drawingPoints.length > 1 && (\n          <polyline\n            points={drawingPoints.map(([x, y]) => `${x * imageScale.scaleX},${y * imageScale.scaleY}`).join(' ')}\n            fill=\"none\"\n            stroke=\"#FF6B6B\"\n            strokeWidth={2}\n            strokeDasharray=\"5,5\"\n          />\n        )}\n        \n        {/* Draw vertex points */}\n        {drawingPoints.map(([x, y], index) => (\n          <circle\n            key={`drawing-${index}`}\n            cx={x * imageScale.scaleX}\n            cy={y * imageScale.scaleY}\n            r={4}\n            fill=\"#FF6B6B\"\n            stroke=\"#FF4757\"\n            strokeWidth={2}\n          />\n        ))}\n      </g>\n    );\n  };\n\n  // Render spine region as polygon within an SVG aligned to the image\n  const renderSpineRegion = (spine: SpineRegion) => {\n    const book = getBookData(spine.id);\n    const points = getScaledPoints(spine);\n    const { x: cx, y: cy } = getCentroid(spine);\n    const isSelected = selectedSpineId === spine.id;\n    const isHovered = hoveredSpineId === spine.id;\n    const isEditing = editingState.mode === 'editing' && editingState.spineId === spine.id;\n    const isDrawing = editingState.mode === 'drawing' && editingState.spineId === spine.id;\n    const hasSelection = selectedSpineId !== null;\n    const isOtherSelected = hasSelection && !isSelected;\n\n    // Only show spines that are being edited or not in editing mode\n    if (editingBookId && !isEditing && !isDrawing && book?.spine_region_id !== editingBookId) {\n      return null;\n    }\n\n    const fill = isEditing || isDrawing ? 'rgba(255,107,107,0.3)' : \n                 isSelected ? 'rgba(59,130,246,0.25)' : \n                 isHovered ? 'rgba(59,130,246,0.18)' : \n                 'rgba(59,130,246,0.12)';\n    const stroke = isEditing || isDrawing ? '#FF6B6B' :\n                  isSelected ? '#60A5FA' : \n                  isHovered ? '#3B82F6' : \n                  '#2563EB';\n    const opacity = isOtherSelected && !isEditing && !isDrawing ? 0.35 : 1;\n\n    return (\n      <g key={spine.id} style={{ opacity }}\n         onMouseEnter={() => handleSpineHover(spine.id)}\n         onMouseLeave={() => handleSpineHover(null)}\n         onClick={() => handleSpineClick(spine.id)}\n      >\n        <polygon points={points} fill={fill} stroke={stroke} strokeWidth={2} />\n        \n        {/* Spine number label at centroid */}\n        <text x={cx} y={cy} textAnchor=\"middle\" dominantBaseline=\"middle\" fill=\"#fff\" fontSize={12} fontWeight={600}>\n          {spineRegions.findIndex(s => s.id === spine.id) + 1}\n        </text>\n        \n\n        \n        {/* Vertex handles for editing */}\n        {renderVertexHandles(spine)}\n        \n        {/* Tooltip near centroid */}\n        {hoveredSpineId === spine.id && book && overlayRect && !isEditing && (\n          <foreignObject x={Math.min(Math.max(cx + 8, 0), overlayRect.width - 200)} y={Math.max(cy - 40, 0)} width={200} height={80}>\n            <div className=\"bg-gray-900 text-white text-xs px-3 py-2 rounded-lg shadow-lg\" style={{ pointerEvents: 'none' }}>\n              <div className=\"font-medium mb-1 truncate\">{book.title}</div>\n              <div className=\"text-gray-300 truncate\">by {Array.isArray(book.author_name) ? book.author_name.join(', ') : book.author_name || 'Unknown Author'}</div>\n              {book.first_publish_year && (\n                <div className=\"text-gray-400\">{book.first_publish_year}</div>\n              )}\n            </div>\n          </foreignObject>\n        )}\n      </g>\n    );\n  };\n\n  return (\n    <div className=\"card p-0 overflow-hidden\">\n      {/* Header */}\n      <div className=\"p-6 border-b border-gray-200\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n              Book Spine Detection\n            </h3>\n            <p className=\"text-sm text-gray-600\">\n              {spineRegions.length} spine{spineRegions.length !== 1 ? 's' : ''} detected\n              {bookMatches.length > 0 && ` • ${bookMatches.length} book${bookMatches.length !== 1 ? 's' : ''} identified`}\n            </p>\n          </div>\n          \n          {/* Editing Controls */}\n          {!isFinalized && (\n            <div className=\"flex items-center space-x-2\">\n                             {editingState.mode === 'none' && editingBookId && (\n                 <>\n                   <button\n                     onClick={() => startDrawing(editingBookId)}\n                     className=\"btn-secondary text-sm px-3 py-1 flex items-center space-x-1\"\n                   >\n                     <Plus className=\"w-4 h-4\" />\n                     <span>Draw OBB</span>\n                   </button>\n                 </>\n               )}\n              \n              {editingState.mode === 'drawing' && (\n                <>\n                  <button\n                    onClick={saveManualDrawing}\n                    disabled={drawingPoints.length < 3}\n                    className=\"btn-primary text-sm px-3 py-1 flex items-center space-x-1 disabled:opacity-50\"\n                  >\n                    <Save className=\"w-4 h-4\" />\n                    <span>Save OBB</span>\n                  </button>\n                  <button\n                    onClick={cancelEditing}\n                    className=\"btn-danger text-sm px-3 py-1 flex items-center space-x-1\"\n                  >\n                    <X className=\"w-4 h-4\" />\n                    <span>Cancel</span>\n                  </button>\n                </>\n              )}\n              \n              {editingState.mode === 'editing' && (\n                <>\n                  <button\n                    onClick={cancelEditing}\n                    className=\"btn-secondary text-sm px-3 py-1 flex items-center space-x-1\"\n                  >\n                    <Move className=\"w-4 h-4\" />\n                    <span>Drag vertices to edit</span>\n                  </button>\n                  <button\n                    onClick={cancelEditing}\n                    className=\"btn-primary text-sm px-3 py-1 flex items-center space-x-1\"\n                  >\n                    <Save className=\"w-4 h-4\" />\n                    <span>Done</span>\n                  </button>\n                </>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Image Container */}\n      <div \n        ref={containerRef}\n        className=\"relative bg-gray-100 min-h-[400px] flex items-center justify-center\"\n      >\n        {!imageLoaded && (\n          <div className=\"text-center text-gray-500\">\n            <BookOpen className=\"w-12 h-12 mx-auto mb-2 text-gray-400\" />\n            <p>Loading image...</p>\n          </div>\n        )}\n\n        {/* Main Image */}\n        <img\n          ref={imageRef}\n          src={imageUrl}\n          alt=\"Book spines\"\n          className=\"max-w-full max-h-[600px] object-contain\"\n          onLoad={() => setImageLoaded(true)}\n          onError={() => setImageLoaded(false)}\n        />\n\n        {/* Spine Regions Overlay */}\n        {imageLoaded && overlayRect && (\n          <svg\n            ref={svgRef}\n            className=\"absolute cursor-crosshair\"\n            style={{ left: overlayRect.left, top: overlayRect.top }}\n            width={overlayRect.width}\n            height={overlayRect.height}\n            onClick={handleSvgClick}\n            onMouseMove={handleMouseMove}\n            onMouseUp={handleVertexDragEnd}\n          >\n            {spineRegions.map(renderSpineRegion)}\n            {renderDrawingPoints()}\n          </svg>\n        )}\n\n        {/* No Spines Detected */}\n        {imageLoaded && spineRegions.length === 0 && editingState.mode !== 'drawing' && (\n          <div className=\"absolute inset-0 flex items-center justify-center bg-white bg-opacity-90\">\n            <div className=\"text-center text-gray-500\">\n              <AlertCircle className=\"w-12 h-12 mx-auto mb-2 text-gray-400\" />\n              <p className=\"text-lg font-medium\">No book spines detected</p>\n              <p className=\"text-sm\">Try uploading a clearer image or draw spines manually</p>\n            </div>\n          </div>\n        )}\n\n        {/* Drawing Instructions */}\n        {imageLoaded && editingState.mode === 'drawing' && (\n          <div className=\"absolute top-4 left-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg\">\n            <p className=\"text-sm font-medium\">Click to add vertices. Need at least 3 points.</p>\n            <p className=\"text-xs opacity-90\">Click \"Save OBB\" when done</p>\n          </div>\n        )}\n      </div>\n\n      {/* Legend */}\n      {spineRegions.length > 0 && (\n        <div className=\"p-4 bg-gray-50 border-t border-gray-200\">\n          <div className=\"flex items-center justify-between text-sm text-gray-600\">\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"w-3 h-3 bg-primary-500 rounded\"></div>\n                <span>Detected spine</span>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <div className=\"w-3 h-3 bg-primary-600 rounded ring-2 ring-primary-400\"></div>\n                <span>Selected</span>\n              </div>\n              {!isFinalized && (\n                <>\n                  <div className=\"flex items-center space-x-2\">\n                    <div className=\"w-3 h-3 bg-red-500 rounded\"></div>\n                    <span>Editing</span>\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    <div className=\"w-3 h-3 bg-red-400 rounded\"></div>\n                    <span>Drawing</span>\n                  </div>\n                </>\n              )}\n            </div>\n            \n            <div className=\"text-xs\">\n              {editingState.mode === 'none' && 'Click on spine regions to select books'}\n              {editingState.mode === 'drawing' && 'Click on image to draw spine outline'}\n              {editingState.mode === 'editing' && 'Drag red vertices to edit spine shape'}\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default SpineVisualizer;\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,MAAM,EAAEC,SAAS,EAAEC,WAAW,QAAQ,OAAO;AAEvE,SAASC,QAAQ,EAAEC,WAAW,EAASC,IAAI,EAAEC,IAAI,EAAEC,CAAC,EAAEC,IAAI,QAAQ,cAAc;AAAC,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAuBjF,MAAMC,eAA+C,GAAGA,CAAC;EACvDC,QAAQ;EACRC,YAAY;EACZC,WAAW;EACXC,eAAe;EACfC,eAAe;EACfC,WAAW;EACXC,qBAAqB;EACrBC,kBAAkB;EAClBC;AACF,CAAC,KAAK;EAAAC,EAAA;EACJ,MAAM,CAACC,WAAW,EAAEC,cAAc,CAAC,GAAG1B,QAAQ,CAAC,KAAK,CAAC;EACrD,MAAM,CAAC2B,cAAc,EAAEC,iBAAiB,CAAC,GAAG5B,QAAQ,CAAgB,IAAI,CAAC;EACzE,MAAM,CAAC6B,UAAU,EAAEC,aAAa,CAAC,GAAG9B,QAAQ,CAAC;IAAE+B,MAAM,EAAE,CAAC;IAAEC,MAAM,EAAE,CAAC;IAAEC,OAAO,EAAE,CAAC;IAAEC,OAAO,EAAE;EAAE,CAAC,CAAC;EAC9F,MAAM,CAACC,WAAW,EAAEC,cAAc,CAAC,GAAGpC,QAAQ,CAAsE,IAAI,CAAC;EACzH,MAAM,CAACqC,YAAY,EAAEC,eAAe,CAAC,GAAGtC,QAAQ,CAAe;IAC7DuC,IAAI,EAAE,MAAM;IACZC,OAAO,EAAE,IAAI;IACbC,WAAW,EAAE,IAAI;IACjBC,UAAU,EAAE;EACd,CAAC,CAAC;EACF,MAAM,CAACC,aAAa,EAAEC,gBAAgB,CAAC,GAAG5C,QAAQ,CAAqB,EAAE,CAAC;EAE1E,MAAM6C,QAAQ,GAAG5C,MAAM,CAAmB,IAAI,CAAC;EAC/C,MAAM6C,YAAY,GAAG7C,MAAM,CAAiB,IAAI,CAAC;EACjD,MAAM8C,MAAM,GAAG9C,MAAM,CAAgB,IAAI,CAAC;;EAE1C;EACAC,SAAS,CAAC,MAAM;IACd,IAAI2C,QAAQ,CAACG,OAAO,IAAIvB,WAAW,EAAE;MACnC,MAAMwB,GAAG,GAAGJ,QAAQ,CAACG,OAAO;MAC5B,MAAME,SAAS,GAAGJ,YAAY,CAACE,OAAO;MAEtC,IAAIE,SAAS,EAAE;QACb,MAAMC,aAAa,GAAGD,SAAS,CAACE,qBAAqB,CAAC,CAAC;QACvD,MAAMC,OAAO,GAAGJ,GAAG,CAACG,qBAAqB,CAAC,CAAC;;QAE3C;QACA,MAAMrB,MAAM,GAAGsB,OAAO,CAACC,KAAK,GAAGL,GAAG,CAACM,YAAY;QAC/C,MAAMvB,MAAM,GAAGqB,OAAO,CAACG,MAAM,GAAGP,GAAG,CAACQ,aAAa;;QAEjD;QACA,MAAMxB,OAAO,GAAGoB,OAAO,CAACK,IAAI,GAAGP,aAAa,CAACO,IAAI;QACjD,MAAMxB,OAAO,GAAGmB,OAAO,CAACM,GAAG,GAAGR,aAAa,CAACQ,GAAG;QAE/C7B,aAAa,CAAC;UAAEC,MAAM;UAAEC,MAAM;UAAEC,OAAO;UAAEC;QAAQ,CAAC,CAAC;QACnDE,cAAc,CAAC;UAAEsB,IAAI,EAAEzB,OAAO;UAAE0B,GAAG,EAAEzB,OAAO;UAAEoB,KAAK,EAAED,OAAO,CAACC,KAAK;UAAEE,MAAM,EAAEH,OAAO,CAACG;QAAO,CAAC,CAAC;MAC/F;IACF;EACF,CAAC,EAAE,CAAC/B,WAAW,CAAC,CAAC;;EAEjB;EACA,MAAMmC,eAAe,GAAIC,KAAkB,IAAK;IAC9C,IAAI,CAACA,KAAK,CAACC,WAAW,IAAID,KAAK,CAACC,WAAW,CAACC,MAAM,KAAK,CAAC,EAAE,OAAO,EAAE;IACnE,OAAOF,KAAK,CAACC,WAAW,CACrBE,GAAG,CAAC,CAAC,CAACC,CAAC,EAAEC,CAAC,CAAC,KAAK;MACf,MAAMC,EAAE,GAAGF,CAAC,GAAGpC,UAAU,CAACE,MAAM;MAChC,MAAMqC,EAAE,GAAGF,CAAC,GAAGrC,UAAU,CAACG,MAAM;MAChC,OAAO,GAAGmC,EAAE,IAAIC,EAAE,EAAE;IACtB,CAAC,CAAC,CACDC,IAAI,CAAC,GAAG,CAAC;EACd,CAAC;;EAED;EACA,MAAMC,mBAAmB,GAAGA,CAACC,IAAY,EAAEC,IAAY,KAAuB;IAC5E,OAAO,CAACD,IAAI,GAAG1C,UAAU,CAACE,MAAM,EAAEyC,IAAI,GAAG3C,UAAU,CAACG,MAAM,CAAC;EAC7D,CAAC;;EAED;EACA,MAAMyC,WAAW,GAAIZ,KAAkB,IAAK;IAC1C,IAAI,CAACA,KAAK,CAACC,WAAW,IAAID,KAAK,CAACC,WAAW,CAACC,MAAM,KAAK,CAAC,EAAE,OAAO;MAAEE,CAAC,EAAE,CAAC;MAAEC,CAAC,EAAE;IAAE,CAAC;IAC/E,MAAMQ,GAAG,GAAGb,KAAK,CAACC,WAAW;IAC7B,MAAMa,EAAE,GAAGD,GAAG,CAACE,MAAM,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,GAAGJ,GAAG,CAACX,MAAM;IACzD,MAAMgB,EAAE,GAAGL,GAAG,CAACE,MAAM,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,GAAGJ,GAAG,CAACX,MAAM;IACzD,OAAO;MAAEE,CAAC,EAAEU,EAAE,GAAG9C,UAAU,CAACE,MAAM;MAAEmC,CAAC,EAAEa,EAAE,GAAGlD,UAAU,CAACG;IAAO,CAAC;EACjE,CAAC;;EAED;EACA,MAAMgD,cAAc,GAAIC,EAAU,IAAK;IACrC,OAAOjE,YAAY,CAACkE,IAAI,CAACrB,KAAK,IAAIA,KAAK,CAACoB,EAAE,KAAKA,EAAE,CAAC;EACpD,CAAC;;EAED;EACA,MAAME,WAAW,GAAI3C,OAAe,IAAK;IACvC,OAAOvB,WAAW,CAACiE,IAAI,CAACE,IAAI,IAAIA,IAAI,CAACC,eAAe,KAAK7C,OAAO,CAAC;EACnE,CAAC;;EAED;EACA,MAAM8C,gBAAgB,GAAI9C,OAAe,IAAK;IAC5C,IAAIH,YAAY,CAACE,IAAI,KAAK,SAAS,EAAE,OAAO,CAAC;IAC7CpB,eAAe,CAACqB,OAAO,CAAC;EAC1B,CAAC;;EAED;EACA,MAAM+C,gBAAgB,GAAI/C,OAAsB,IAAK;IACnD,IAAIH,YAAY,CAACE,IAAI,KAAK,SAAS,EAAE,OAAO,CAAC;IAC7CX,iBAAiB,CAACY,OAAO,CAAC;EAC5B,CAAC;;EAED;EACA,MAAMgD,YAAY,GAAIhD,OAAe,IAAK;IACxCF,eAAe,CAAC;MACdC,IAAI,EAAE,SAAS;MACfC,OAAO;MACPC,WAAW,EAAE,IAAI;MACjBC,UAAU,EAAE;IACd,CAAC,CAAC;EACJ,CAAC;;EAED;EACA,MAAM+C,YAAY,GAAIjD,OAAe,IAAK;IACxCF,eAAe,CAAC;MACdC,IAAI,EAAE,SAAS;MACfC,OAAO;MACPC,WAAW,EAAE,IAAI;MACjBC,UAAU,EAAE;IACd,CAAC,CAAC;IACFE,gBAAgB,CAAC,EAAE,CAAC;EACtB,CAAC;;EAED;EACA,MAAM8C,aAAa,GAAGA,CAAA,KAAM;IAC1BpD,eAAe,CAAC;MACdC,IAAI,EAAE,MAAM;MACZC,OAAO,EAAE,IAAI;MACbC,WAAW,EAAE,IAAI;MACjBC,UAAU,EAAE;IACd,CAAC,CAAC;IACFE,gBAAgB,CAAC,EAAE,CAAC;EACtB,CAAC;;EAED;EACA,MAAM+C,iBAAiB,GAAGA,CAAA,KAAM;IAC9B,IAAIhD,aAAa,CAACoB,MAAM,IAAI,CAAC,IAAIzC,kBAAkB,EAAE;MACnD,MAAMsE,QAAqB,GAAG;QAC5BX,EAAE,EAAE,UAAUY,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE;QAC1B7B,CAAC,EAAE8B,IAAI,CAACC,GAAG,CAAC,GAAGrD,aAAa,CAACqB,GAAG,CAACc,CAAC,IAAIA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAC5CZ,CAAC,EAAE6B,IAAI,CAACC,GAAG,CAAC,GAAGrD,aAAa,CAACqB,GAAG,CAACc,CAAC,IAAIA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAC5CxB,KAAK,EAAEyC,IAAI,CAACE,GAAG,CAAC,GAAGtD,aAAa,CAACqB,GAAG,CAACc,CAAC,IAAIA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAGiB,IAAI,CAACC,GAAG,CAAC,GAAGrD,aAAa,CAACqB,GAAG,CAACc,CAAC,IAAIA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAC5FtB,MAAM,EAAEuC,IAAI,CAACE,GAAG,CAAC,GAAGtD,aAAa,CAACqB,GAAG,CAACc,CAAC,IAAIA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAGiB,IAAI,CAACC,GAAG,CAAC,GAAGrD,aAAa,CAACqB,GAAG,CAACc,CAAC,IAAIA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAC7FoB,QAAQ,EAAE,CAAC;QACXC,UAAU,EAAE,GAAG;QACfrC,WAAW,EAAEnB;MACf,CAAC;MAEDrB,kBAAkB,CAACsE,QAAQ,CAAC;MAC5BF,aAAa,CAAC,CAAC;IACjB;EACF,CAAC;;EAED;EACA,MAAMU,cAAc,GAAIC,KAAsC,IAAK;IACjE,IAAIhE,YAAY,CAACE,IAAI,KAAK,SAAS,EAAE;IAErC,MAAM+D,GAAG,GAAGvD,MAAM,CAACC,OAAO;IAC1B,IAAI,CAACsD,GAAG,EAAE;IAEV,MAAMC,IAAI,GAAGD,GAAG,CAAClD,qBAAqB,CAAC,CAAC;IACxC,MAAMa,CAAC,GAAGoC,KAAK,CAACG,OAAO,GAAGD,IAAI,CAAC7C,IAAI;IACnC,MAAMQ,CAAC,GAAGmC,KAAK,CAACI,OAAO,GAAGF,IAAI,CAAC5C,GAAG;IAElC,MAAM+C,WAAW,GAAGpC,mBAAmB,CAACL,CAAC,EAAEC,CAAC,CAAC;IAC7CtB,gBAAgB,CAAC+D,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAED,WAAW,CAAC,CAAC;EAClD,CAAC;;EAED;EACA,MAAME,qBAAqB,GAAGA,CAACpE,OAAe,EAAEC,WAAmB,KAAK;IACtEH,eAAe,CAACqE,IAAI,KAAK;MACvB,GAAGA,IAAI;MACPpE,IAAI,EAAE,SAAS;MACfC,OAAO;MACPC,WAAW;MACXC,UAAU,EAAE;IACd,CAAC,CAAC,CAAC;EACL,CAAC;;EAED;EACA,MAAMmE,gBAAgB,GAAG1G,WAAW,CAAC,CAACqC,OAAe,EAAEC,WAAmB,EAAEqE,IAAY,EAAEC,IAAY,KAAK;IACzG,IAAI,CAAC1F,qBAAqB,EAAE;IAE5B,MAAMqF,WAAW,GAAGpC,mBAAmB,CAACwC,IAAI,EAAEC,IAAI,CAAC;IACnD,MAAMC,cAAc,GAAGhG,YAAY,CAACgD,GAAG,CAACH,KAAK,IAAI;MAC/C,IAAIA,KAAK,CAACoB,EAAE,KAAKzC,OAAO,IAAIqB,KAAK,CAACC,WAAW,EAAE;QAC7C,MAAMmD,cAAc,GAAG,CAAC,GAAGpD,KAAK,CAACC,WAAW,CAAC;QAC7CmD,cAAc,CAACxE,WAAW,CAAC,GAAGiE,WAAW;QACzC,OAAO;UAAE,GAAG7C,KAAK;UAAEC,WAAW,EAAEmD;QAAe,CAAC;MAClD;MACA,OAAOpD,KAAK;IACd,CAAC,CAAC;IAEFxC,qBAAqB,CAAC2F,cAAc,CAAC;EACvC,CAAC,EAAE,CAAChG,YAAY,EAAEK,qBAAqB,EAAEQ,UAAU,CAAC,CAAC;;EAErD;EACA,MAAMqF,eAAe,GAAG/G,WAAW,CAAEkG,KAAsC,IAAK;IAC9E,IAAIhE,YAAY,CAACE,IAAI,KAAK,SAAS,IAAI,CAACF,YAAY,CAACK,UAAU,IAAI,CAACL,YAAY,CAACG,OAAO,IAAIH,YAAY,CAACI,WAAW,KAAK,IAAI,EAAE;IAE/H,MAAM6D,GAAG,GAAGvD,MAAM,CAACC,OAAO;IAC1B,IAAI,CAACsD,GAAG,EAAE;IAEV,MAAMC,IAAI,GAAGD,GAAG,CAAClD,qBAAqB,CAAC,CAAC;IACxC,MAAMa,CAAC,GAAGoC,KAAK,CAACG,OAAO,GAAGD,IAAI,CAAC7C,IAAI;IACnC,MAAMQ,CAAC,GAAGmC,KAAK,CAACI,OAAO,GAAGF,IAAI,CAAC5C,GAAG;IAElCkD,gBAAgB,CAACxE,YAAY,CAACG,OAAO,EAAEH,YAAY,CAACI,WAAW,EAAEwB,CAAC,EAAEC,CAAC,CAAC;EACxE,CAAC,EAAE,CAAC7B,YAAY,EAAEwE,gBAAgB,CAAC,CAAC;;EAEpC;EACA,MAAMM,mBAAmB,GAAGA,CAAA,KAAM;IAChC7E,eAAe,CAACqE,IAAI,KAAK;MACvB,GAAGA,IAAI;MACPjE,UAAU,EAAE;IACd,CAAC,CAAC,CAAC;EACL,CAAC;;EAED;EACA,MAAM0E,mBAAmB,GAAIvD,KAAkB,IAAK;IAAA,IAAAwD,kBAAA;IAClD,IAAIhF,YAAY,CAACE,IAAI,KAAK,SAAS,IAAIF,YAAY,CAACG,OAAO,KAAKqB,KAAK,CAACoB,EAAE,EAAE,OAAO,IAAI;IAErF,QAAAoC,kBAAA,GAAOxD,KAAK,CAACC,WAAW,cAAAuD,kBAAA,uBAAjBA,kBAAA,CAAmBrD,GAAG,CAAC,CAACsD,KAAK,EAAEC,KAAK,KAAK;MAC9C,MAAM,CAACtD,CAAC,EAAEC,CAAC,CAAC,GAAGoD,KAAK;MACpB,MAAM/C,IAAI,GAAGN,CAAC,GAAGpC,UAAU,CAACE,MAAM;MAClC,MAAMyC,IAAI,GAAGN,CAAC,GAAGrC,UAAU,CAACG,MAAM;MAElC,oBACErB,OAAA;QAEEgE,EAAE,EAAEJ,IAAK;QACTQ,EAAE,EAAEP,IAAK;QACTgD,CAAC,EAAE,CAAE;QACLC,IAAI,EAAC,SAAS;QACdC,MAAM,EAAC,SAAS;QAChBC,WAAW,EAAE,CAAE;QACfC,MAAM,EAAC,MAAM;QACbC,WAAW,EAAGC,CAAC,IAAK;UAClBA,CAAC,CAACC,eAAe,CAAC,CAAC;UACnBnB,qBAAqB,CAAC/C,KAAK,CAACoB,EAAE,EAAEsC,KAAK,CAAC;QACxC,CAAE;QACFS,SAAS,EAAEb,mBAAoB;QAC/Bc,KAAK,EAAE;UAAEC,aAAa,EAAE7F,YAAY,CAACK,UAAU,GAAG,MAAM,GAAG;QAAO;MAAE,GAb/D,UAAUmB,KAAK,CAACoB,EAAE,IAAIsC,KAAK,EAAE;QAAAY,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAcnC,CAAC;IAEN,CAAC,CAAC;EACJ,CAAC;;EAED;EACA,MAAMC,mBAAmB,GAAGA,CAAA,KAAM;IAChC,IAAIlG,YAAY,CAACE,IAAI,KAAK,SAAS,IAAII,aAAa,CAACoB,MAAM,KAAK,CAAC,EAAE,OAAO,IAAI;IAE9E,oBACEpD,OAAA;MAAA6H,QAAA,GAEG7F,aAAa,CAACoB,MAAM,GAAG,CAAC,iBACvBpD,OAAA;QACE8H,MAAM,EAAE9F,aAAa,CAACqB,GAAG,CAAC,CAAC,CAACC,CAAC,EAAEC,CAAC,CAAC,KAAK,GAAGD,CAAC,GAAGpC,UAAU,CAACE,MAAM,IAAImC,CAAC,GAAGrC,UAAU,CAACG,MAAM,EAAE,CAAC,CAACqC,IAAI,CAAC,GAAG,CAAE;QACrGoD,IAAI,EAAC,MAAM;QACXC,MAAM,EAAC,SAAS;QAChBC,WAAW,EAAE,CAAE;QACfe,eAAe,EAAC;MAAK;QAAAP,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACtB,CACF,EAGA3F,aAAa,CAACqB,GAAG,CAAC,CAAC,CAACC,CAAC,EAAEC,CAAC,CAAC,EAAEqD,KAAK,kBAC/B5G,OAAA;QAEEgE,EAAE,EAAEV,CAAC,GAAGpC,UAAU,CAACE,MAAO;QAC1BgD,EAAE,EAAEb,CAAC,GAAGrC,UAAU,CAACG,MAAO;QAC1BwF,CAAC,EAAE,CAAE;QACLC,IAAI,EAAC,SAAS;QACdC,MAAM,EAAC,SAAS;QAChBC,WAAW,EAAE;MAAE,GANV,WAAWJ,KAAK,EAAE;QAAAY,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAOxB,CACF,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACD,CAAC;EAER,CAAC;;EAED;EACA,MAAMK,iBAAiB,GAAI9E,KAAkB,IAAK;IAChD,MAAMuB,IAAI,GAAGD,WAAW,CAACtB,KAAK,CAACoB,EAAE,CAAC;IAClC,MAAMwD,MAAM,GAAG7E,eAAe,CAACC,KAAK,CAAC;IACrC,MAAM;MAAEI,CAAC,EAAEU,EAAE;MAAET,CAAC,EAAEa;IAAG,CAAC,GAAGN,WAAW,CAACZ,KAAK,CAAC;IAC3C,MAAM+E,UAAU,GAAG1H,eAAe,KAAK2C,KAAK,CAACoB,EAAE;IAC/C,MAAM4D,SAAS,GAAGlH,cAAc,KAAKkC,KAAK,CAACoB,EAAE;IAC7C,MAAM6D,SAAS,GAAGzG,YAAY,CAACE,IAAI,KAAK,SAAS,IAAIF,YAAY,CAACG,OAAO,KAAKqB,KAAK,CAACoB,EAAE;IACtF,MAAM8D,SAAS,GAAG1G,YAAY,CAACE,IAAI,KAAK,SAAS,IAAIF,YAAY,CAACG,OAAO,KAAKqB,KAAK,CAACoB,EAAE;IACtF,MAAM+D,YAAY,GAAG9H,eAAe,KAAK,IAAI;IAC7C,MAAM+H,eAAe,GAAGD,YAAY,IAAI,CAACJ,UAAU;;IAEnD;IACA,IAAIrH,aAAa,IAAI,CAACuH,SAAS,IAAI,CAACC,SAAS,IAAI,CAAA3D,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEC,eAAe,MAAK9D,aAAa,EAAE;MACxF,OAAO,IAAI;IACb;IAEA,MAAMkG,IAAI,GAAGqB,SAAS,IAAIC,SAAS,GAAG,uBAAuB,GAChDH,UAAU,GAAG,uBAAuB,GACpCC,SAAS,GAAG,uBAAuB,GACnC,uBAAuB;IACpC,MAAMnB,MAAM,GAAGoB,SAAS,IAAIC,SAAS,GAAG,SAAS,GACnCH,UAAU,GAAG,SAAS,GACtBC,SAAS,GAAG,SAAS,GACrB,SAAS;IACvB,MAAMK,OAAO,GAAGD,eAAe,IAAI,CAACH,SAAS,IAAI,CAACC,SAAS,GAAG,IAAI,GAAG,CAAC;IAEtE,oBACEpI,OAAA;MAAkBsH,KAAK,EAAE;QAAEiB;MAAQ,CAAE;MAClCC,YAAY,EAAEA,CAAA,KAAM5D,gBAAgB,CAAC1B,KAAK,CAACoB,EAAE,CAAE;MAC/CmE,YAAY,EAAEA,CAAA,KAAM7D,gBAAgB,CAAC,IAAI,CAAE;MAC3C8D,OAAO,EAAEA,CAAA,KAAM/D,gBAAgB,CAACzB,KAAK,CAACoB,EAAE,CAAE;MAAAuD,QAAA,gBAE3C7H,OAAA;QAAS8H,MAAM,EAAEA,MAAO;QAAChB,IAAI,EAAEA,IAAK;QAACC,MAAM,EAAEA,MAAO;QAACC,WAAW,EAAE;MAAE;QAAAQ,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC,eAGvE3H,OAAA;QAAMsD,CAAC,EAAEU,EAAG;QAACT,CAAC,EAAEa,EAAG;QAACuE,UAAU,EAAC,QAAQ;QAACC,gBAAgB,EAAC,QAAQ;QAAC9B,IAAI,EAAC,MAAM;QAAC+B,QAAQ,EAAE,EAAG;QAACC,UAAU,EAAE,GAAI;QAAAjB,QAAA,EACzGxH,YAAY,CAAC0I,SAAS,CAACC,CAAC,IAAIA,CAAC,CAAC1E,EAAE,KAAKpB,KAAK,CAACoB,EAAE,CAAC,GAAG;MAAC;QAAAkD,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC/C,CAAC,EAKNlB,mBAAmB,CAACvD,KAAK,CAAC,EAG1BlC,cAAc,KAAKkC,KAAK,CAACoB,EAAE,IAAIG,IAAI,IAAIjD,WAAW,IAAI,CAAC2G,SAAS,iBAC/DnI,OAAA;QAAesD,CAAC,EAAE8B,IAAI,CAACC,GAAG,CAACD,IAAI,CAACE,GAAG,CAACtB,EAAE,GAAG,CAAC,EAAE,CAAC,CAAC,EAAExC,WAAW,CAACmB,KAAK,GAAG,GAAG,CAAE;QAACY,CAAC,EAAE6B,IAAI,CAACE,GAAG,CAAClB,EAAE,GAAG,EAAE,EAAE,CAAC,CAAE;QAACzB,KAAK,EAAE,GAAI;QAACE,MAAM,EAAE,EAAG;QAAAgF,QAAA,eACxH7H,OAAA;UAAKiJ,SAAS,EAAC,+DAA+D;UAAC3B,KAAK,EAAE;YAAEC,aAAa,EAAE;UAAO,CAAE;UAAAM,QAAA,gBAC9G7H,OAAA;YAAKiJ,SAAS,EAAC,2BAA2B;YAAApB,QAAA,EAAEpD,IAAI,CAACyE;UAAK;YAAA1B,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM,CAAC,eAC7D3H,OAAA;YAAKiJ,SAAS,EAAC,wBAAwB;YAAApB,QAAA,GAAC,KAAG,EAACsB,KAAK,CAACC,OAAO,CAAC3E,IAAI,CAAC4E,WAAW,CAAC,GAAG5E,IAAI,CAAC4E,WAAW,CAAC3F,IAAI,CAAC,IAAI,CAAC,GAAGe,IAAI,CAAC4E,WAAW,IAAI,gBAAgB;UAAA;YAAA7B,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM,CAAC,EACtJlD,IAAI,CAAC6E,kBAAkB,iBACtBtJ,OAAA;YAAKiJ,SAAS,EAAC,eAAe;YAAApB,QAAA,EAAEpD,IAAI,CAAC6E;UAAkB;YAAA9B,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM,CAC9D;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACE;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACO,CAChB;IAAA,GA5BKzE,KAAK,CAACoB,EAAE;MAAAkD,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OA6Bb,CAAC;EAER,CAAC;EAED,oBACE3H,OAAA;IAAKiJ,SAAS,EAAC,0BAA0B;IAAApB,QAAA,gBAEvC7H,OAAA;MAAKiJ,SAAS,EAAC,8BAA8B;MAAApB,QAAA,eAC3C7H,OAAA;QAAKiJ,SAAS,EAAC,mCAAmC;QAAApB,QAAA,gBAChD7H,OAAA;UAAA6H,QAAA,gBACE7H,OAAA;YAAIiJ,SAAS,EAAC,0CAA0C;YAAApB,QAAA,EAAC;UAEzD;YAAAL,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAI,CAAC,eACL3H,OAAA;YAAGiJ,SAAS,EAAC,uBAAuB;YAAApB,QAAA,GACjCxH,YAAY,CAAC+C,MAAM,EAAC,QAAM,EAAC/C,YAAY,CAAC+C,MAAM,KAAK,CAAC,GAAG,GAAG,GAAG,EAAE,EAAC,WACjE,EAAC9C,WAAW,CAAC8C,MAAM,GAAG,CAAC,IAAI,MAAM9C,WAAW,CAAC8C,MAAM,QAAQ9C,WAAW,CAAC8C,MAAM,KAAK,CAAC,GAAG,GAAG,GAAG,EAAE,aAAa;UAAA;YAAAoE,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC1G,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACD,CAAC,EAGL,CAAClH,WAAW,iBACXT,OAAA;UAAKiJ,SAAS,EAAC,6BAA6B;UAAApB,QAAA,GAC1BnG,YAAY,CAACE,IAAI,KAAK,MAAM,IAAIhB,aAAa,iBAC1DZ,OAAA,CAAAE,SAAA;YAAA2H,QAAA,eACE7H,OAAA;cACE0I,OAAO,EAAEA,CAAA,KAAM5D,YAAY,CAAClE,aAAa,CAAE;cAC3CqI,SAAS,EAAC,6DAA6D;cAAApB,QAAA,gBAEvE7H,OAAA,CAACL,IAAI;gBAACsJ,SAAS,EAAC;cAAS;gBAAAzB,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAE,CAAC,eAC5B3H,OAAA;gBAAA6H,QAAA,EAAM;cAAQ;gBAAAL,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAM,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACf;UAAC,gBACT,CACH,EAEDjG,YAAY,CAACE,IAAI,KAAK,SAAS,iBAC9B5B,OAAA,CAAAE,SAAA;YAAA2H,QAAA,gBACE7H,OAAA;cACE0I,OAAO,EAAE1D,iBAAkB;cAC3BuE,QAAQ,EAAEvH,aAAa,CAACoB,MAAM,GAAG,CAAE;cACnC6F,SAAS,EAAC,+EAA+E;cAAApB,QAAA,gBAEzF7H,OAAA,CAACJ,IAAI;gBAACqJ,SAAS,EAAC;cAAS;gBAAAzB,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAE,CAAC,eAC5B3H,OAAA;gBAAA6H,QAAA,EAAM;cAAQ;gBAAAL,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAM,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACf,CAAC,eACT3H,OAAA;cACE0I,OAAO,EAAE3D,aAAc;cACvBkE,SAAS,EAAC,0DAA0D;cAAApB,QAAA,gBAEpE7H,OAAA,CAACH,CAAC;gBAACoJ,SAAS,EAAC;cAAS;gBAAAzB,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAE,CAAC,eACzB3H,OAAA;gBAAA6H,QAAA,EAAM;cAAM;gBAAAL,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAM,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACb,CAAC;UAAA,eACT,CACH,EAEAjG,YAAY,CAACE,IAAI,KAAK,SAAS,iBAC9B5B,OAAA,CAAAE,SAAA;YAAA2H,QAAA,gBACE7H,OAAA;cACE0I,OAAO,EAAE3D,aAAc;cACvBkE,SAAS,EAAC,6DAA6D;cAAApB,QAAA,gBAEvE7H,OAAA,CAACF,IAAI;gBAACmJ,SAAS,EAAC;cAAS;gBAAAzB,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAE,CAAC,eAC5B3H,OAAA;gBAAA6H,QAAA,EAAM;cAAqB;gBAAAL,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAM,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAC5B,CAAC,eACT3H,OAAA;cACE0I,OAAO,EAAE3D,aAAc;cACvBkE,SAAS,EAAC,2DAA2D;cAAApB,QAAA,gBAErE7H,OAAA,CAACJ,IAAI;gBAACqJ,SAAS,EAAC;cAAS;gBAAAzB,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAE,CAAC,eAC5B3H,OAAA;gBAAA6H,QAAA,EAAM;cAAI;gBAAAL,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAM,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACX,CAAC;UAAA,eACT,CACH;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACE,CACN;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACE;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACH,CAAC,eAGN3H,OAAA;MACEwJ,GAAG,EAAErH,YAAa;MAClB8G,SAAS,EAAC,qEAAqE;MAAApB,QAAA,GAE9E,CAAC/G,WAAW,iBACXd,OAAA;QAAKiJ,SAAS,EAAC,2BAA2B;QAAApB,QAAA,gBACxC7H,OAAA,CAACP,QAAQ;UAACwJ,SAAS,EAAC;QAAsC;UAAAzB,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE,CAAC,eAC7D3H,OAAA;UAAA6H,QAAA,EAAG;QAAgB;UAAAL,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAG,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACpB,CACN,eAGD3H,OAAA;QACEwJ,GAAG,EAAEtH,QAAS;QACduH,GAAG,EAAErJ,QAAS;QACdsJ,GAAG,EAAC,aAAa;QACjBT,SAAS,EAAC,yCAAyC;QACnDU,MAAM,EAAEA,CAAA,KAAM5I,cAAc,CAAC,IAAI,CAAE;QACnC6I,OAAO,EAAEA,CAAA,KAAM7I,cAAc,CAAC,KAAK;MAAE;QAAAyG,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACtC,CAAC,EAGD7G,WAAW,IAAIU,WAAW,iBACzBxB,OAAA;QACEwJ,GAAG,EAAEpH,MAAO;QACZ6G,SAAS,EAAC,2BAA2B;QACrC3B,KAAK,EAAE;UAAEvE,IAAI,EAAEvB,WAAW,CAACuB,IAAI;UAAEC,GAAG,EAAExB,WAAW,CAACwB;QAAI,CAAE;QACxDL,KAAK,EAAEnB,WAAW,CAACmB,KAAM;QACzBE,MAAM,EAAErB,WAAW,CAACqB,MAAO;QAC3B6F,OAAO,EAAEjD,cAAe;QACxBoE,WAAW,EAAEtD,eAAgB;QAC7Bc,SAAS,EAAEb,mBAAoB;QAAAqB,QAAA,GAE9BxH,YAAY,CAACgD,GAAG,CAAC2E,iBAAiB,CAAC,EACnCJ,mBAAmB,CAAC,CAAC;MAAA;QAAAJ,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACnB,CACN,EAGA7G,WAAW,IAAIT,YAAY,CAAC+C,MAAM,KAAK,CAAC,IAAI1B,YAAY,CAACE,IAAI,KAAK,SAAS,iBAC1E5B,OAAA;QAAKiJ,SAAS,EAAC,0EAA0E;QAAApB,QAAA,eACvF7H,OAAA;UAAKiJ,SAAS,EAAC,2BAA2B;UAAApB,QAAA,gBACxC7H,OAAA,CAACN,WAAW;YAACuJ,SAAS,EAAC;UAAsC;YAAAzB,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC,eAChE3H,OAAA;YAAGiJ,SAAS,EAAC,qBAAqB;YAAApB,QAAA,EAAC;UAAuB;YAAAL,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAG,CAAC,eAC9D3H,OAAA;YAAGiJ,SAAS,EAAC,SAAS;YAAApB,QAAA,EAAC;UAAqD;YAAAL,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAG,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC7E;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH,CACN,EAGA7G,WAAW,IAAIY,YAAY,CAACE,IAAI,KAAK,SAAS,iBAC7C5B,OAAA;QAAKiJ,SAAS,EAAC,6EAA6E;QAAApB,QAAA,gBAC1F7H,OAAA;UAAGiJ,SAAS,EAAC,qBAAqB;UAAApB,QAAA,EAAC;QAA8C;UAAAL,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAG,CAAC,eACrF3H,OAAA;UAAGiJ,SAAS,EAAC,oBAAoB;UAAApB,QAAA,EAAC;QAA0B;UAAAL,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAG,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC7D,CACN;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACE,CAAC,EAGLtH,YAAY,CAAC+C,MAAM,GAAG,CAAC,iBACtBpD,OAAA;MAAKiJ,SAAS,EAAC,yCAAyC;MAAApB,QAAA,eACtD7H,OAAA;QAAKiJ,SAAS,EAAC,yDAAyD;QAAApB,QAAA,gBACtE7H,OAAA;UAAKiJ,SAAS,EAAC,6BAA6B;UAAApB,QAAA,gBAC1C7H,OAAA;YAAKiJ,SAAS,EAAC,6BAA6B;YAAApB,QAAA,gBAC1C7H,OAAA;cAAKiJ,SAAS,EAAC;YAAgC;cAAAzB,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eACtD3H,OAAA;cAAA6H,QAAA,EAAM;YAAc;cAAAL,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACxB,CAAC,eACN3H,OAAA;YAAKiJ,SAAS,EAAC,6BAA6B;YAAApB,QAAA,gBAC1C7H,OAAA;cAAKiJ,SAAS,EAAC;YAAwD;cAAAzB,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eAC9E3H,OAAA;cAAA6H,QAAA,EAAM;YAAQ;cAAAL,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAClB,CAAC,EACL,CAAClH,WAAW,iBACXT,OAAA,CAAAE,SAAA;YAAA2H,QAAA,gBACE7H,OAAA;cAAKiJ,SAAS,EAAC,6BAA6B;cAAApB,QAAA,gBAC1C7H,OAAA;gBAAKiJ,SAAS,EAAC;cAA4B;gBAAAzB,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAM,CAAC,eAClD3H,OAAA;gBAAA6H,QAAA,EAAM;cAAO;gBAAAL,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAM,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACjB,CAAC,eACN3H,OAAA;cAAKiJ,SAAS,EAAC,6BAA6B;cAAApB,QAAA,gBAC1C7H,OAAA;gBAAKiJ,SAAS,EAAC;cAA4B;gBAAAzB,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAM,CAAC,eAClD3H,OAAA;gBAAA6H,QAAA,EAAM;cAAO;gBAAAL,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAM,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACjB,CAAC;UAAA,eACN,CACH;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACE,CAAC,eAEN3H,OAAA;UAAKiJ,SAAS,EAAC,SAAS;UAAApB,QAAA,GACrBnG,YAAY,CAACE,IAAI,KAAK,MAAM,IAAI,wCAAwC,EACxEF,YAAY,CAACE,IAAI,KAAK,SAAS,IAAI,sCAAsC,EACzEF,YAAY,CAACE,IAAI,KAAK,SAAS,IAAI,uCAAuC;QAAA;UAAA4F,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACxE,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACH,CACN;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACE,CAAC;AAEV,CAAC;AAAC9G,EAAA,CA5fIV,eAA+C;AAAA2J,EAAA,GAA/C3J,eAA+C;AA8frD,eAAeA,eAAe;AAAC,IAAA2J,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}